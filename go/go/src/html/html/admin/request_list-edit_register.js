"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof date_utils_js&&document.write("<script src='/assets/js/common/util/date_utils.js'><\/script>"),"undefined"==typeof ipsap_item_module_js&&document.write("<script src='/assets/js/ipsap/ipsap_item_module.js'><\/script>");var reqsvc_seq=IPSAP.getStor("reqsvc_seq");function getInfo(){API.load({url:eval("`"+CONST.API.REQUEST.DETAIL+"`"),type:CONST.API_TYPE.GET,success:function(e){var a="";if(e.tmp_approved_dttm=getDttm(e.approved_dttm),e.tmp_phoneno=e.phoneno.replace(/(^02.{0}|^01.{1}|[0-9]{3})([0-9]+)([0-9]{4})/,"$1-$2-$3"),e.tmp_telno=e.telno.replace(/(^02.{0}|^01.{1}|[0-9]{3})([0-9]+)([0-9]{4})/,"$1-$2-$3"),a="0"==e.request_status?"미처리":"1"==e.request_status?"처리중":"2"==e.request_status?`처리보류: ${e.tmp_approved_dttm.dt}`:`처리완료: ${e.tmp_approved_dttm.dt}`,$(".apptype_date").text(a),$(".req_memo").text(e.approved_comment),e.institution_type.length>0){$(`input:radio[name="org_type"][value="${e.institution_type}"]`).prop("checked","checked")}$("#org_name_kr").val(`${e.name_ko}`),$("#org_name_en").val(`${e.name_en}`),$("#org_code").val(`${e.institution_code}`),$("#org_zipcode").val(`${e.zipcode}`),$("#addr_str_1").text(`${e.addr1}`),$("#addr_str_2").val(`${e.addr2}`),$("#org_url").val(`${e.homepage_url}`),$("label.with_small_delete").text(`${e.logo_file_org_name}`),$("#man_name_kr").val(`${e.user_name}`),$("#man_name_en").val(`${e.user_name_en}`),$("#man_id").val(`${e.email}`),$("#man_part").val(`${e.dept_str}`),$("#man_position").val(`${e.position_str}`),$("#man_tel").val(`${e.tmp_telno}`),$("#man_cell").val(`${e.tmp_phoneno}`),"1"==e.agree_email?$("#agree_email").prop("checked",!0):$("#agree_email").prop("checked",!1),"1"==e.agree_sms?$("#agree_sms").prop("checked",!0):$("#agree_sms").prop("checked",!1),"1"==e.agree_pri_open?$("#agree_info").prop("checked",!0):$("#agree_info").prop("checked",!1);var t=e.judge_type.split(",");$('input:checkbox[name="evaluation_type"]').each((function(){-1!=$.inArray(this.value,t)?this.checked=!0:this.checked=!1})),"1"==e.ia_evaluation_method?($('input:radio[name="org_rule_1"][value="1"]').prop("checked",!0),$('input:radio[name="org_rule_1"][value="2"]').prop("checked",!1),$("#IACUC_agree_point").val(`${e.ia_base_score}`)):($('input:radio[name="org_rule_1"][value="2"]').prop("checked",!0),$('input:radio[name="org_rule_1"][value="1"]').prop("checked",!1),$("#IACUC_agree_count").val(`${e.ia_base_item}`)),"1"==e.ia_final_director?$('input:radio[name="org_rule_2"][value="1"]').prop("checked",!0):$('input:radio[name="org_rule_2"][value="2"]').prop("checked",!0),$(".formrow14").find("span.data").eq(0).text(`${e.business_num}`),$(".formrow14").find("span.data").eq(1).html(`<a href="${e.business_file_src}" target="_blank">${e.business_file_org_name}</a>`);var n=e.payment_method.split(",");$('input:checkbox[name="payment_type"]').each((function(){-1!=$.inArray(this.value,n)?(this.checked=!0,this.readOnly=!0):(this.checked=!1,this.disabled=!0)})),"1"==e.invoice_flag?($('input:radio[name="org_invoice"][value="1"]').prop("checked",!0),$('input:radio[name="org_invoice"][value="1"]').prop("readonly",!0),$('input:radio[name="org_invoice"][value="2"]').prop("disabled",!0)):($('input:radio[name="org_invoice"][value="2"]').prop("checked",!0),$('input:radio[name="org_invoice"][value="2"]').prop("readonly",!0),$('input:radio[name="org_invoice"][value="1"]').prop("disabled",!0))},error:function(e){}})}function serviceSave(){var logo_file=$("#org_logo_file")[0].files[0],judge_type_arr=[];$('input:checkbox[name="evaluation_type"]').each((function(){this.checked&&judge_type_arr.push(this.value)}));var institutionObj=new Object;institutionObj.addr1=$("#addr_str_1").text(),institutionObj.addr2=$("#addr_str_2").val(),institutionObj.homepage_url=$("#org_url").val(),institutionObj.ia_base_item=parseInt($("#IACUC_agree_count").val()),institutionObj.ia_base_score=parseInt($("#IACUC_agree_point").val()),institutionObj.ia_evaluation_method=parseInt($("input:radio[name=org_rule_1]:checked").val()),institutionObj.ia_final_director=parseInt($("input:radio[name=org_rule_2]:checked").val()),institutionObj.institution_code=$("#org_code").val(),institutionObj.institution_type=parseInt($("input:radio[name=org_type]:checked").val()),institutionObj.judge_type=judge_type_arr.toString(),institutionObj.name_en=$("#org_name_en").val(),institutionObj.name_ko=$("#org_name_kr").val(),institutionObj.zipcode=$("#org_zipcode").val();var userObj=new Object;userObj.agree_email=parseInt($("#agree_email").val()),userObj.agree_pri_open=parseInt($("#agree_info").val()),userObj.agree_sms=parseInt($("#agree_sms").val()),userObj.dept=$("#man_part").val(),userObj.email=$("#man_id").val(),userObj.name=$("#man_name_kr").val(),userObj.name_en=$("#man_name_en").val(),userObj.phoneno=$("#man_cell").val().replaceAll("-",""),userObj.position=$("#man_position").val(),userObj.telno=$("#man_tel").val().replaceAll("-",""),userObj.user_type="1";var sendingObj=new Object;sendingObj.institution=institutionObj,sendingObj.user=userObj;var sendingJson=JSON.stringify(sendingObj),formData=new FormData;formData.append("logo_file",logo_file),formData.append("param",sendingJson),API.load({url:eval("`"+CONST.API.REQUEST.PATCH+"`"),type:CONST.API_TYPE.PATCH,enctype:"multipart/form-data",data:formData,contentType:!1,processData:!1,success:function(e){window.location.replace("./request_list-info_register.html")},error:function(e){$("#modal_error_code").text(e.responseText),$("#modal_register_error").modal("show")}})}$((function(){if(!IPSAP.DEMO_MODE){var e=$(".page-content");$("#org_code").on("input",(function(){$("#org_code").val().length>=3&&$("#org_code").val().length<6?$("#btn-dup-check").attr("disabled",!1):$("#btn-dup-check").attr("disabled",!0)})),$("#btn-dup-check").on("click",(function(){!function(){var e=$("#org_code").val();if(""==e)return $("#modalCode").find(".valid").css("display","none"),void $("#modalCode").find(".invalid > h5").text("입력하신 코드가 없습니다.");if(e.length<3)return $("#modalCode").find(".valid").css("display","none"),void $("#modalCode").find(".invalid > h5").text("최소 3자리 이상 입력이 필요합니다.");API.load({url:CONST.API.COMMON.DUP_CHECK.INST_CODE,type:CONST.API_TYPE.GET,data:{institution_code:e},success:function(e){"ok"==e.rt&&($("#modalCode").find(".valid").css("display","block"),$("#modalCode").find(".invalid").css("display","none"))},error:function(e){3==e.responseJSON.e&&($("#modalCode").find(".valid").css("display","none"),$("#modalCode").find(".invalid > h5").text("이미 등록된 기관 코드입니다. 기관 코드를 다시 확인해주세요."),$("#org_code").val(""))}})}()})),$("#org_name_kr").on("keyup",(function(){$(this).val($(this).val().replace(/[^가-힣0-9\s]/gi,""))})),$("#man_name_kr").on("keyup",(function(){$(this).val($(this).val().replace(/[^가-힣0-9]/gi,""))})),$("#org_name_en").on("keyup",(function(){$(this).val($(this).val().replace(/[^a-zA-Z0-9\s]/gi,""))})),$("#man_name_en").on("keyup",(function(){$(this).val($(this).val().replace(/[^a-zA-Z0-9\s-]/gi,""))})),$("#org_code").on("keyup",(function(){$(this).val($(this).val().replace(/[^A-Z0-9]/g,""))})),$("#org_logo_file").on("change",(function(){!function(){var a=e.find("#bodyForm").find("#org_logo_file")[0].files[0];if(""!=$("#org_logo_file").val()){let e=a.name.split(".").pop().toLowerCase();if(-1==$.inArray(e,["jpg","png","jpeg","ico","tiff","svg"]))return alert(".jpg, .png, .jpeg, .tiff 등 이미지 파일 형식으로 첨부해 주십시오."),void $("#org_logo_file").val("");if(a.size>20971520)$("#modal_file_alert").modal("show"),$("#org_logo_file").val("")}}()})),$("input:radio[name=org_rule_1]").on("click",(function(){"1"==$("input:radio[name=org_rule_1]:checked").val()?($("#IACUC_agree_point").attr("disabled",!1),$("#IACUC_agree_count").attr("disabled",!0),$("#IACUC_agree_count").val(0)):"2"==$("input:radio[name=org_rule_1]:checked").val()&&($("#IACUC_agree_count").attr("disabled",!1),$("#IACUC_agree_point").attr("disabled",!0),$("#IACUC_agree_point").val(0))})),$("#btn_save").on("click",(function(){serviceSave()})),getInfo()}}));