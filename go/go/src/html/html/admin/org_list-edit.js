"undefined"==typeof ipsap_common_js&&document.write("<script src='/assets/js/ipsap/ipsap_common.js'><\/script>"),"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof date_utils_js&&document.write("<script src='/assets/js/common/util/date_utils.js'><\/script>"),"undefined"==typeof ipsap_application_common_js&&document.write("<script src='/assets/js/ipsap/ipsap_application_common.js'><\/script>");var inst_seq=COMM.getStor("inst_seq"),g_user_list;function getInfo(){API.load({url:eval("`"+CONST.API.INSTITUTION.DETAIL+"`"),type:CONST.API_TYPE.GET,success:function(e){if("0"==e.service_status?$("#org_status_0").prop("checked",!0):"1"==e.service_status?$("#org_status_1").prop("checked",!0):"2"==e.service_status?$("#org_status_2").prop("checked",!0):$("#org_status_3").prop("checked",!0),e.institution_type.length>0){$(`input:radio[name="org_type"][value="${e.institution_type}"]`).prop("checked","checked")}$("#org_name_kr").val(e.name_ko),$("#org_name_en").val(e.name_en),$("#org_code").val(e.institution_code),$("#org_zipcode").val(e.zipcode),$("#addr_str_1").text(e.addr1),$("#addr_str_2").val(e.addr2),$("#org_url").val(e.homepage_url),$('label[for="org_logo_file"]').text(e.logo_file_org_name);var a=0,n=$(".man_div").clone();if($(".man_div").remove(),$.each(e.user_list,(function(i,t){g_user_list=e.user_list;var o=n.clone();o.removeClass("man_div").addClass("man_div_"+a++),o.find(".man_name_kr").val(t.user_name),o.find(".man_name_en").val(t.user_name_en),o.find(".man_id").val(t.email),o.find("button").attr("onclick",`initPw(${t.user_seq});`),o.find(".man_part").val(t.dept_str),o.find(".man_position").val(t.position_str),o.find(".man_tel").val(t.telno.replace(/(^02.{0}|^01.{1}|[0-9]{3})([0-9]+)([0-9]{4})/,"$1-$2-$3")),o.find(".man_cell").val(t.phoneno.replace(/(^02.{0}|^01.{1}|[0-9]{3})([0-9]+)([0-9]{4})/,"$1-$2-$3")),"1"==t.agree_email&&o.find(".agree_email").prop("checked","checked"),"1"==t.agree_sms&&o.find(".agree_sms").prop("checked","checked"),"1"==t.agree_pri_open&&o.find(".agree_info").prop("checked","checked"),$("#officer_list").append(o)})),e.judge_type.length>0){let a=[];a.push(e.judge_type.split(",")),$.each(a[0],(function(e,a){$(`input:checkbox[name="evaluation_type"][value="${a}"]`).attr("checked",!0)}))}if(1==e.ia_evaluation_method?($("#org_rule_1_1").prop("checked","checked"),$("#IACUC_agree_point").val(e.ia_base_score)):2==e.ia_evaluation_method?($("#org_rule_1_2").prop("checked","checked"),$("#IACUC_agree_count").val(e.ia_base_item)):$("#org_rule_1_3").prop("checked","checked"),1==e.ia_final_director?$("#org_rule_2_1").prop("checked","checked"):$("#org_rule_2_2").prop("checked","checked"),$("#org_registration_num").val(e.business_num),$(".custom-file-label").text(e.business_file_org_name),e.payment_method.length>0){let a=e.payment_method.split(",");$.each(a,(function(e,a){$(`input:checkbox[name="payment_type"][value="${a}"]`).attr("checked",!0)}))}if(e.invoice_flag.length>0){$(`input:radio[name="org_invoice"][value="${e.invoice_flag}"]`).prop("checked","checked")}$("#bodyForm").removeClass("hidden")},complete:function(){}})}function initPw(user_seq){IPSAP.DEMO_MODE||($("#modal_init_pw").modal("show"),$("#btn_init_pw").on("click",(function(){API.load({url:eval("`"+CONST.API.PLATFORM.REGI_USER_RESET_PWD+"`"),type:CONST.API_TYPE.PATCH,success:function(e){$("#modal_init_pw").modal("hide")},error:function(e){}})})))}function setInfo(){$(".page-content");var e=$("#org_logo_file")[0].files[0],a=$("#org_registration_file")[0].files[0],n=[];$('input:checkbox[name="evaluation_type"]').each((function(){this.checked&&n.push(this.value)}));var i=[];$('input:checkbox[name="payment_type"]').each((function(){this.checked&&i.push(this.value)}));var t=new Object;t.institution_seq=Number(COMM.getStor("inst_seq")),t.institution_type=parseInt($("input:radio[name=org_type]:checked").val()),t.name_ko=$("#org_name_kr").val(),t.name_en=$("#org_name_en").val(),t.institution_code=$("#org_code").val(),t.zipcode=$("#org_zipcode").val(),t.addr1=$("#addr_str_1").text(),t.addr2=$("#addr_str_2").val(),t.homepage_url=$("#org_url").val(),t.judge_type=n.toString(),t.ia_base_item=parseInt($("#IACUC_agree_count").val()),t.ia_base_score=parseInt($("#IACUC_agree_point").val()),t.ia_evaluation_method=parseInt($("input:radio[name=org_rule_1]:checked").val()),t.ia_final_director=parseInt($("input:radio[name=org_rule_2]:checked").val()),t.business_num=$("#org_registration_num").val().replaceAll("-",""),t.payment_method=i.toString(),t.invoice_flag=parseInt($("input:radio[name=org_invoice]:checked").val()),t.service_status=Number($("input:radio[name=org_status]:checked").val());for(var o=[],_=0;_<g_user_list.length;_++){var r=new Object;r={agree_email:parseInt($(`.man_div_${_}`).find(".agree_email").val()),agree_pri_open:parseInt($(`.man_div_${_}`).find(".agree_info").val()),agree_sms:parseInt($(`.man_div_${_}`).find(".agree_sms").val()),name:$(`.man_div_${_}`).find(".man_name_kr").val(),name_en:$(`.man_div_${_}`).find(".man_name_en").val(),email:$(`.man_div_${_}`).find(".man_id").val(),dept:$(`.man_div_${_}`).find(".man_part").val(),position:$(`.man_div_${_}`).find(".man_position").val(),telno:$(`.man_div_${_}`).find(".man_tel").val(),phoneno:$(`.man_div_${_}`).find(".man_cell").val(),institution_seq:parseInt(g_user_list[_].institution_seq),user_seq:parseInt(g_user_list[_].user_seq)},o.push(r)}var s={institution:t,userArr:o},l=JSON.stringify(s),d=new FormData;d.append("logo_file",e),d.append("business_file",a),d.append("param",l),API.load({url:CONST.API.PLATFORM.INSTITUTION_PATCH,type:CONST.API_TYPE.PATCH,enctype:"multipart/form-data",data:d,contentType:!1,processData:!1,success:function(e){COMM.setCookie("logo_file_src",e.logo_file_src),$("#modal_confirm").modal("show")},error:function(e){}})}$((function(){if(IPSAP.DEMO_MODE)return void $("#bodyForm").removeClass("hidden");let e=$("#org_status_0, #org_status_1, #org_status_2, #org_status_3"),a=$("#status_1_desc, #status_2_desc, #status_3_desc"),n=$("#status_msg"),i=$("#msg_comment");function t(e){e.each(((e,a)=>{let t=$(a),o=t.parent().find("label").text(),_=t.attr("id").replace("org_","#")+"_desc";t.prop("checked")&&($(_).length?($(_).attr("hidden",!1),i.addClass("red"),n.removeClass("blue_vivid").addClass("pink_vivid").text(o),$("#modal_confirm .symbol").addClass("red")):(i.removeClass("red"),n.removeClass("pink_vivid").addClass("blue_vivid").text(o),$("#modal_confirm .symbol").removeClass("red")))}))}t(e),e.on({click:e=>{a.attr("hidden",!0),t($(e.currentTarget))}}),$("#org_code").on("input",(function(){$("#org_code").val().length>=3&&$("#org_code").val().length<6?$("#btn-dup-check").attr("disabled",!1):$("#btn-dup-check").attr("disabled",!0)})),$("#btn-dup-check").on("click",(function(){!function(){var e=$("#org_code").val();if(""==e)return $("#modalCode").find(".valid").css("display","none"),void $("#modalCode").find(".invalid > h5").text("입력하신 코드가 없습니다.");if(e.length<3)return $("#modalCode").find(".valid").css("display","none"),void $("#modalCode").find(".invalid > h5").text("최소 3자리 이상 입력이 필요합니다.");API.load({url:CONST.API.COMMON.DUP_CHECK.INST_CODE,type:CONST.API_TYPE.GET,data:{institution_code:e},success:function(e){"ok"==e.rt&&($("#modalCode").find(".valid").css("display","block"),$("#modalCode").find(".invalid").css("display","none"),$("#dup-checked").val("y"))},error:function(e){3==e.responseJSON.e&&($("#modalCode").find(".valid").css("display","none"),$("#modalCode").find(".invalid > h5").text("이미 등록된 기관 코드입니다. 기관 코드를 다시 확인해주세요."),$("#org_code").val(""))}})}()})),$("#org_name_kr").on("keyup",(function(){$(this).val($(this).val().replace(/[^가-힣0-9\s]/gi,""))})),$(".man_name_kr").on("keyup",(function(){$(this).val($(this).val().replace(/[^가-힣0-9]/gi,""))})),$("#org_name_en").on("keyup",(function(){$(this).val($(this).val().replace(/[^a-zA-Z0-9\s]/gi,""))})),$(".man_name_en").on("keyup",(function(){$(this).val($(this).val().replace(/[^a-zA-Z0-9\s-]/gi,""))})),$("#org_code").on("keyup",(function(){$(this).val($(this).val().replace(/[^A-Z0-9]/g,""))})),$("#org_logo_file").on("change",(function(){!function(){var e=contents.find("#bodyForm").find("#org_logo_file")[0].files[0];if(""!=$("#org_logo_file").val()){let a=e.name.split(".").pop().toLowerCase();if(-1==$.inArray(a,["jpg","png","jpeg","ico","tiff","svg"]))return alert(".jpg, .png, .jpeg, .tiff 등 이미지 파일 형식으로 첨부해 주십시오."),void $("#org_logo_file").val("");if(e.size>20971520)$("#modal_file_alert").modal("show"),$("#org_logo_file").val("")}}()})),$("#org_registration_file").on("change",(function(){!function(){var e=contents.find("#bodyForm").find("#org_registration_file")[0].files[0];if(""!=$("#org_registration_file").val()){let a=e.name.split(".").pop().toLowerCase();if(-1==$.inArray(a,["jpg","png","jpeg","ico","tiff","svg","pdf"]))return alert(".jpg, .png, .pdf, .tiff 등 이미지 파일 형식으로 첨부해 주십시오."),void $("#org_registration_file").val("");if(e.size>20971520)$("#modal_file_alert").modal("show"),$("#org_registration_file").val("")}}()})),$("input:radio[name=org_rule_1]").on("click",(function(){"1"==$("input:radio[name=org_rule_1]:checked").val()?($("#IACUC_agree_point").attr("disabled",!1),$("#IACUC_agree_count").attr("disabled",!0),$("#IACUC_agree_count").val(0)):"2"==$("input:radio[name=org_rule_1]:checked").val()?($("#IACUC_agree_count").attr("disabled",!1),$("#IACUC_agree_point").attr("disabled",!0),$("#IACUC_agree_point").val(0)):"3"==$("input:radio[name=org_rule_1]:checked").val()&&($("#IACUC_agree_count").attr("disabled",!0),$("#IACUC_agree_point").attr("disabled",!0),$("#IACUC_agree_count").val(0),$("#IACUC_agree_point").val(0))})),$("#btn_set_info").on("click",(function(e){e.stopPropagation(),setInfo()})),getInfo()}));