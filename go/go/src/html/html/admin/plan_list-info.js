"undefined"==typeof ipsap_common_js&&document.write("<script src='/assets/js/ipsap/ipsap_common.js'><\/script>"),"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof date_utils_js&&document.write("<script src='/assets/js/common/util/date_utils.js'><\/script>");const plan_seq=IPSAP.getStor("plan_seq");var plan_product_seq="",membership_product_seq="";function getPlanDetail(){var e=CONST.API.MEMBERSHIP.PLAN.DETAIL;API.load({url:e.replace("${plan_seq}",plan_seq),type:CONST.API_TYPE.GET,success:function(e){let a=e.value[0];$("#plan_name").val(a.name),0==a.plan_available?$("#availability").prop("checked",!1):$("#availability").prop("checked",!0),$("#org_subsFee").val(setComma(a.products[1].price)),$("#org_monthlyFee").val(setComma(a.products[0].price)),$("#rate_subsFee").val(100*a.products[1].discount_rate),$("#rate_MonthlyFee").val(100*a.products[0].discount_rate),$("#real_subsFee").val(setComma(a.products[1].discounted_amount)),$("#real_MonthlyFee").val(setComma(a.products[0].discounted_amount)),$("#limit").val(a.usage_limit),$("#plan_desc").val(a.desc_text),plan_product_seq=a.products[0].product_seq,membership_product_seq=a.products[1].product_seq},complete:function(){$(".card").removeClass("hidden"),initDataTable("#datatable")}})}function savePlan(){var e=new Object;e.desc_text=$("#plan_desc").val(),e.membership_category="membership",e.membership_discount_amount=Number($("#org_subsFee").val().replace(/,/g,""))-Number($("#real_subsFee").val().replace(/,/g,"")),e.membership_discount_rate=parseInt($("#rate_subsFee").val())/100,e.membership_discount_type="R",e.membership_discounted_amount=Number($("#real_subsFee").val().replace(/,/g,"")),e.membership_price=Number($("#org_subsFee").val().replace(/,/g,"")),e.membership_pid=e.membership_category+e.membership_price+"_"+moment().unix(new Date),e.name=$("#plan_name").val(),$("#availability").is(":checked")?e.plan_available=1:e.plan_available=0,e.plan_category="plan",e.plan_discount_amount=Number($("#org_monthlyFee").val().replace(/,/g,""))-Number($("#real_MonthlyFee").val().replace(/,/g,"")),e.plan_discount_rate=parseInt($("#rate_MonthlyFee").val())/100,e.plan_discount_type="R",e.plan_discounted_amount=Number($("#real_MonthlyFee").val().replace(/,/g,"")),e.plan_price=Number($("#org_monthlyFee").val().replace(/,/g,"")),e.plan_pid=e.plan_category+e.plan_price+"_"+moment().unix(new Date),e.usage_limit=Number($("#limit").val()),e.plan_product_seq=plan_product_seq,e.membership_product_seq=membership_product_seq;let a=CONST.API.MEMBERSHIP.PLAN.PATCH;API.load({url:a.replace("${plan_seq}",plan_seq),type:CONST.API_TYPE.PATCH,data:e,success:function(e){},complete:function(){location.replace("./plan_list.html")}})}function deletePlan(){let e=CONST.API.MEMBERSHIP.PLAN.DELETE;API.load({url:e.replace("${plan_seq}",plan_seq),type:CONST.API_TYPE.DELETE,success:function(e){},complete:function(){location.replace("./plan_list.html")}})}$((function(){IPSAP.DEMO_MODE?($(".card").removeClass("hidden"),initDataTable("#datatable")):(getPlanDetail(),$("#btn_plan_save").on("click",(function(){savePlan()})),$("#btn_plan_delete").on("click",(function(){deletePlan()})))})),$(window).on({load:e=>{$("#org_subsFee, #org_monthlyFee, #rate_subsFee, #rate_MonthlyFee, #real_subsFee, #real_MonthlyFee").each(((e,a)=>{a.value=setComma(a.value)}))}}),$("#org_subsFee, #org_monthlyFee, #rate_subsFee, #rate_MonthlyFee, #real_subsFee, #real_MonthlyFee").on({input:e=>{var a=e.currentTarget,t=$("#org_subsFee"),l=$("#org_monthlyFee"),s=$("#rate_subsFee"),r=$("#rate_MonthlyFee"),n=$("#real_subsFee"),o=$("#real_MonthlyFee"),p=t.val().replace(/,/g,""),c=l.val().replace(/,/g,""),_=s.val().replace(/,/g,""),u=r.val().replace(/,/g,""),i=n.val().replace(/,/g,""),m=o.val().replace(/,/g,"");a.value=a.value.replace(/[^0-9.]/g,"").replace(/(\..*)\./g,"$1"),a.value=setComma(a.value),"rate_subsFee"==$(a).attr("id")?(_=a.value.replace(/,/g,""),n.val(setComma(p-p*_*.01))):"real_subsFee"==$(a).attr("id")?(i=a.value.replace(/,/g,""),s.val(setComma((100-i/p*100).toFixed(2)))):"org_subsFee"==$(a).attr("id")&&(p=a.value.replace(/,/g,""),n.val(setComma(p-p*_*.01))),"rate_MonthlyFee"==$(a).attr("id")?(u=a.value.replace(/,/g,""),o.val(setComma(c-c*u*.01))):"real_MonthlyFee"==$(a).attr("id")?(m=a.value.replace(/,/g,""),r.val(setComma((100-m/c*100).toFixed(2)))):"org_monthlyFee"==$(a).attr("id")&&(p=a.value.replace(/,/g,""),$pure_org_monthlyFee.val(setComma(c-c*u*.01)))}}),$("#reseter").on({click:e=>{$("form[name=plan_form]")[0].reset(),$("#org_subsFee, #org_monthlyFee, #rate_subsFee, #rate_MonthlyFee, #real_subsFee, #real_MonthlyFee").each(((e,a)=>{a.value=setComma(a.value)}))}});