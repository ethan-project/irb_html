var g_free_seq,total_data;function getFreeMembershipList(t){API.load({url:CONST.API.MEMBERSHIP.FREE.LIST,type:CONST.API_TYPE.GET,data:{"filter.start_index":t,"filter.row_cnt":10,"filter.use_status":$("#use_status").val(),"filter.search_word":$("#searchKeyword").val()},success:function(e){total_data=e.pageInfo.totalCnt,$("#free_list").empty(),$.each(e.list,(function(t,e){let a="",n="";0==e.purchased_date?(a="unused",n="미이용",cancelHtml=`<td class="text-center">\n                          <button type="button" class="btn btn-xs btn-outline-danger button_new btn_cancel" data-plan-id=${e.free_seq} data-toggle="modal" data-target="#modal_cancel">\n                            <i class="fas fa-times mRight5"></i>지급 취소\n                          </button>\n                        </td></tr>`):(a="used",n="이용 완료",cancelHtml='<td class="text-center">-</td></tr>');let s=`<tr class="${a}">\n                      <td>${getDttm(e.reg_date).dt} ${getDttm(e.reg_date).tm}</td>\n                      <td>${e.name_ko}</td>\n                      <td>IPSAP 무료 멤버십</td>\n                      <td>${e.free_period} 개월</td>\n                      <td class="plan_status">${n}</td>\n                      <td>${getDttm(e.purchased_date).dt} ${getDttm(e.purchased_date).tm}</td>\n                      <td>${e.reason}</td>`;s+=cancelHtml,$("#free_list").append(s)})),paging(total_data,10,10,t/10)},complete:function(){$(".btn_cancel").on("click",(function(){g_free_seq=$(this).attr("data-plan-id")}))}})}function paging(t,e,a,n){n+=1;var s=Math.ceil(t/e),i=Math.ceil(n/a)*a;i>s&&(i=s);var c=i-(a-1);i<e&&(c=i-(i-1));$("#paging");var d='<ul class="pagination">';d+='<li class="paginate_button page-item previous"><a href="javascript:void(0);" id="prev" class="page-link">이전</a></li> ';for(var l=c;l<=i;l++)d+=`<li class="paginate_button page-item pageno${l}"><a href="javascript:void(0);" class="page-link">${l}</a></li>`;d+='<li class="paginate_button page-item next"><a href="javascript:void(0);" id="next" class="page-link">다음</a></li>',d+='<div class="buttons">\n            <button type="button" class="btn btn-sm btn-primary button_new" onclick="assignPlan();"><i class="far fa-credit-card mRight5"></i>무료 멤버십 Plan 지급</button>\n          </div>\n          </ul>',$("#paging").html(d),$("#paging .pageno"+n).addClass("active"),1==n&&$(".previous").addClass("disabled"),n==i&&i==s&&$(".next").addClass("disabled"),$("#list_total").text(t),$("#paging a").click((function(){var e=$(this),a=e.attr("id"),s=e.text();"next"==a&&(s=n+1),"prev"==a&&(s=n-1),paging(t,10,10,s),getFreeMembershipList(10*(s-1))}))}function assignPlan(){$("#modal_inst_list").empty(),getInstListinModal(),$("#modal_assign_plan").modal("show")}function getInstListinModal(){API.load({url:CONST.API.MEMBERSHIP.FREE.AVAILABLE_LIST,type:CONST.API_TYPE.GET,success:function(t){var e=0;$.each(t,(function(t,a){a.telno,e++,$("#modal_inst_list").append(`<tr data-instseq="${a.institution_seq}">\n            <td>${a.name_ko}</td>\n            <td>${a.institution_code}</td>\n            <td>${a.user_name}</td>\n            <td>${a.telno.replace(/(^02.{0}|^01.{1}|[0-9]{3})([0-9]+)([0-9]{4})/,"$1-$2-$3")}</td>\n            <td>${a.business_num}</td>\n            <td>${getDttm(a.reg_dttm).dt}</td>\n            <td>${getDttm(a.membership_payment_date).dt}</td>\n            <td>${moment(a.expiration_date,"YYYYMMDD").add("1","day").format("YYYY-MM-DD")}</td>\n            <td class="text-center">\n              <div class="checkbox checkbox-primary">\n                <input type="checkbox" name="selOrg" id="selOrg${e}" value="${a.institution_code}">\n                <label for="selOrg${e}"></label>\n              </div>\n            </td>\n        </tr>`)}))},complete:function(){$.fn.dataTable.isDataTable("#datatable")||initDataTable("#datatable")}})}function applyFreeMembership(){var t=$("#free_period").val(),e=[];$('input:checkbox[name="selOrg"]').each((function(){$(this).is(":checked")&&e.push($(this).closest("tr").data("instseq"))}));var a=$("#reason").val(),n=Number($("#app_limit").val()),s=new Object;s.free_period=t,s.institution_seqs=e,s.reason=a,s.usage_limit=n,API.load({url:CONST.API.MEMBERSHIP.FREE.APPLY,type:CONST.API_TYPE.POST,data:s,success:function(t){},error:function(t){},complete:function(){location.reload()}})}function cancelFreeMembership(){let t=CONST.API.MEMBERSHIP.FREE.DELETE;API.load({url:t.replace("${free_seq}",g_free_seq),type:CONST.API_TYPE.DELETE,success:function(t){},error:function(t){},complete:function(){location.reload()}})}"undefined"==typeof ipsap_common_js&&document.write("<script src='/assets/js/ipsap/ipsap_common.js'><\/script>"),"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof date_utils_js&&document.write("<script src='/assets/js/common/util/date_utils.js'><\/script>"),$((function(){IPSAP.DEMO_MODE?$(".card").removeClass("hidden"):($(".card").removeClass("hidden"),getFreeMembershipList(0))})),$("#btn_search").on("click",(function(){getFreeMembershipList(0)})),$("#use_status").on("change",(function(){getFreeMembershipList(0)}));