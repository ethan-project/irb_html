function getInstInfo(){let t=CONST.API.INSTITUTION.DETAIL,a=COMM.getStor("inst_seq");$("#inst_info").empty(),API.load({url:t.replace("${inst_seq}",a),type:CONST.API_TYPE.GET,success:function(t){let a=t.user_name.split(" ")[0],n="",s="";$.each(t.user_list,(function(t,e){e.user_name==a&&(n=e.phoneno.replace(/(^02.{0}|^01.{1}|[0-9]{3})([0-9]+)([0-9]{4})/,"$1-$2-$3"),s=e.email)})),$("#inst_info").append(`<tr>\n            <td class="info_name">기관명</td>\n            <td class="data">${t.name_ko} (${t.name_en})</td>\n            <td class="info_name">사업자 등록번호</td>\n            <td class="data">${t.business_num}</td>\n          </tr>\n          <tr>\n            <td class="info_name">행정 간사</td>\n            <td class="data">${t.user_name}</td>\n            <td class="info_name">연락처</td>\n            <td class="data">Tel: ${n}<br>Email: ${s}</td>\n          </tr>\n          <tr>\n            <td class="info_name">세금계산서 발행 여부</td>\n            <td colspan="3" class="data">${t.invoice_flag_str}</td>\n          </tr>`)}})}var g_total_amount;function getPaymentInfo(){let t=CONST.API.ORDERS.DETAIL,a=COMM.getStor("order_seq");$("#payment_info").empty(),API.load({url:t.replace("${order_seq}",a),type:CONST.API_TYPE.GET,success:function(t){let a="";"CARD"==t[0].pay_method?a="신용카드":"BANK"==t[0].pay_method&&(a="계좌이체");let n=!1,s=new Date,e=getDttm(s/1e3).dt.substring(0,7).replace("-","");n=Number(e)>=Number(t[0].the_date);let d=`<tr>\n                <td class="info_name">결제 내용</td>\n                <td class="data">${t[0].pname}</td>\n                <td class="info_name">\n                  <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" data-tippy-arrow="true" title="PG사 승인 번호 (한 번호에 승인, 취소가 모두 묶임)"></i>승인 번호</td>\n                <td class="data">${t[0].auth_code}</td>\n              </tr>\n              <tr class="blank_row"><td colspan="4"></td></tr>\n              <tr>\n                <td class="info_name">결제 구분</td>\n                <td class="data">${a} - <span class="approved fw_bold">승인</span></td>\n                <td class="info_name fw_bold">결제 금액</td>\n                <td>\n                  <span class="data approved fw_bold underline mRight5">${setComma(t[0].amount)}</span>원\n                </td>\n              </tr>\n              <tr>\n                <td class="info_name">\n                  <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" data-tippy-arrow="true" title="IPSAP에서 PG 모듈에 결제를 요청한 시간"></i>결제 일시</td>\n                <td class="data">${moment(t[0].pay_date,"YYYY-MM-DD hh:mm:ss").format("YYYY-MM-DD HH:mm:ss")}</td>\n                <td class="info_name">\n                  <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" data-tippy-arrow="true" title="PG사 모듈에서 승인이 완료된 시간"></i>승인 일시</td>\n                <td class="data">${moment(t[0].auth_date,"YY-MM-DD hh:mm:ss").format("YYYY-MM-DD HH:mm:ss")}</td>\n              </tr>\n              <tr>\n                <td class="info_name">\n                  <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" data-tippy-arrow="true" title="IPSAP 거래 번호 (행정간사가 확인 가능, 매번 새로 발행)"></i>결제 번호</td>\n                <td class="data">${t[0].moid}</td>\n                <td class="info_name">\n                  <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" data-tippy-arrow="true" title="PG사 거래 번호 (매번 새로 발행)"></i>거래 ID (TID)</td>\n                <td class="data">${t[0].tid}</td>\n              </tr>`;if(1==n){let a=0;for(var c=1;c<t.length;c++)a+=Number(t[c].amount);for(c=1;c<t.length;c++)d+=` <tr class="blank_row"><td colspan="4"></td></tr>\n                    <tr>\n                      <td class="info_name">결제 구분</td>\n                      <td class="data">신용카드 - <span class="canceled fw_bold">부분 취소</span></td>\n                      <td class="info_name fw_bold">취소 금액</td>\n                      <td class="data fw_bold"><span class="canceled underline">${t[c].amount}</span><span class="subInfo mLeft5">원</span></td>\n                    </tr>\n                    <tr>\n                      <td class="info_name">결제 일시</td>\n                      <td class="data">${moment(t[c].pay_date,"YYYY-MM-DD hh:mm:ss").format("YYYY-MM-DD HH:mm:ss")}</td>\n                      <td class="info_name">승인 취소 일시</td>\n                      <td class="data">${moment(t[c].auth_date,"YY-MM-DD hh:mm:ss").format("YYYY-MM-DD HH:mm:ss")}</td>\n                    </tr>\n                    <tr>\n                      <td class="info_name"><i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" data-tippy-arrow="true" title="IPSAP 거래 번호 (행정간사가 확인 가능, 매번 새로 발행)"></i>결제 번호</td>\n                      <td class="data">${t[c].moid}</td>\n                      <td class="info_name"><i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" data-tippy-arrow="true" title="PG사 거래 번호 (매번 새로 발행)"></i>거래 ID (TID)</td>\n                      <td class="data">${t[c].tid}</td>\n                    </tr>`;d+=`<tr class="blank_row"><td colspan="4"></td></tr>\n                  <tr>\n                    <td class="info_name">최종 결제 금액</td>\n                    <td class="data"><span class="underline red fw_bold">${setComma(t[0].amount-a)}</span><span class="subInfo mLeft5">원</span></td>\n                    <td class="info_name">\n                    <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" data-tippy-arrow="true" title="해당 이용권으로 서비스를 이용하는 기간"></i>이용 기간</td>\n                    <td class="data">${moment(t[0].auth_date,"YY-MM-DD").format("YYYY-MM-DD")} ~ ${moment(t[0].auth_date,"YY-MM-DD").add("1","year").endOf("month").format("YYYY-MM-DD")}</td>\n                  </tr>`,$("#cancel_all").prop("disabled",!0),$("#cancel_part").prop("checked",!0),$("#cancel_amount").attr("max",t[0].amount-a),$("#cancel_amount").on("input",(function(){$(this).val()>t[0].amount-a&&$(this).val(t[0].amount-a)})),$("#cancel_all").parent().addClass("tippy-btn").attr({"data-tippy-placement":"top-start","data-tippy-arrow":"true",title:"이미 사용중인 결제 건은 전체 취소가 불가능 합니다."})}else{let a=0;for(c=1;c<t.length;c++)a+=Number(t[c].amount);for(c=1;c<t.length;c++)d+=` <tr class="blank_row"><td colspan="4"></td></tr>\n                    <tr>\n                      <td class="info_name">결제 구분</td>\n                      <td class="data">신용카드 - <span class="canceled fw_bold">전체 취소</span></td>\n                      <td class="info_name fw_bold">취소 금액</td>\n                      <td class="data fw_bold"><span class="canceled underline">${t[c].amount}</span><span class="subInfo mLeft5">원</span></td>\n                    </tr>\n                    <tr>\n                      <td class="info_name">결제 일시</td>\n                      <td class="data">${moment(t[c].pay_date,"YYYY-MM-DD hh:mm:ss").format("YYYY-MM-DD HH:mm:ss")}</td>\n                      <td class="info_name">승인 취소 일시</td>\n                      <td class="data">${moment(t[c].auth_date,"YY-MM-DD hh:mm:ss").format("YYYY-MM-DD HH:mm:ss")}</td>\n                    </tr>\n                    <tr>\n                      <td class="info_name">결제 번호</td>\n                      <td class="data">승인 결제와 동일</td>\n                      <td class="info_name">거래 ID (TID)</td>\n                      <td class="data">승인 결제와 동일</td>\n                    </tr>`;d+=`<tr class="blank_row"><td colspan="4"></td></tr>\n                  <tr>\n                    <td class="info_name">최종 결제 금액</td>\n                    <td class="data"><span class="underline red fw_bold">${setComma(t[0].amount-a)}</span><span class="subInfo mLeft5">원</span></td>\n                    <td class="info_name">\n                    <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" data-tippy-arrow="true" title="해당 이용권으로 서비스를 이용하는 기간"></i>이용 기간</td>\n                    <td class="data">이용전</td>\n                  </tr>`,$("#cancel_part").prop("disabled",!0),$("#cancel_all").prop("checked",!0),$("#cancel_amount").prop("readonly",!0),$("#cancel_part").siblings().addClass("tippy-btn"),$("#cancel_part").siblings().attr("data-tippy-placement","top-start"),$("#cancel_part").siblings().attr("data-tippy-arrow",!0),$("#cancel_part").siblings().attr("title","사용전인 결제 건은 부분 취소가 불가능 합니다.")}$("#payment_info").append(d),$("#btn_certificate").attr("onclick",`printReceipt("${t[0].tid}")`);let o=0;for(c=1;c<t.length;c++)o+=Number(t[c].amount);(g_total_amount=t[0].amount-o)<=0?$(".btn_cancel").eq(0).css("display","none"):$(".btn_cancel").eq(1).css("display","none"),$("#payment_name").text(t[0].pname),$("#cancel_amount").val(g_total_amount)},complete:function(){tippy(".tippy-btn",{trigger:"mouseenter"})}})}function printReceipt(t){var a="https://npg.nicepay.co.kr/issue/IssueLoader.do?TID="+t+"&type=0";window.open(a,"popupIssue","toolbar=no,location=no,directories=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,width=420,height=540")}function cancelOrder(){let t=CONST.API.ORDERS.CANCEL,a=COMM.getStor("order_seq"),n={cancel_amt:$("#cancel_amount").val(),partial_cancel_code:$('input:radio[name="cancel_type"]:checked').val()};API.load({url:t.replace("${order_seq}",a),type:CONST.API_TYPE.DELETE,data:n,success:function(t){$("#modal_result").modal("show")},error:function(t){$("#modal_fail").modal("show")}})}function changeInstitutionCondition(){var t={institution_seq:COMM.getStor("inst_seq"),service_status:Number($('input:radio[name="org_status"]').val())};API.load({url:CONST.API.PLATFORM.INSTITUTION_STATUS,type:CONST.API_TYPE.PATCH,data:t,success:function(t){},error:function(t){},complete:function(){location.replace("./payment_list.html")}})}"undefined"==typeof ipsap_common_js&&document.write("<script src='/assets/js/ipsap/ipsap_common.js'><\/script>"),"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof date_utils_js&&document.write("<script src='/assets/js/common/util/date_utils.js'><\/script>"),$((function(){IPSAP.DEMO_MODE||(getInstInfo(),getPaymentInfo()),$(".card").removeClass("hidden"),$("#btn_cancel_done").on("click",(function(t){$("#cancel_amount_confirm").text(setComma($("#cancel_amount").val())),cancelOrder()})),$("#btn_confirm_change").on("click",(function(t){$("#is_change").is(":checked")?changeInstitutionCondition():location.replace("./payment_list.html")}))}));