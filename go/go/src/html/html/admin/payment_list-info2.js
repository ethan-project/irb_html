function getInstInfo(){let t=CONST.API.INSTITUTION.DETAIL,s=COMM.getStor("inst_seq");$("#inst_info").empty(),API.load({url:t.replace("${inst_seq}",s),type:CONST.API_TYPE.GET,success:function(t){let s=t.user_name.split(" ")[0],n="",a="";$.each(t.user_list,(function(t,e){e.user_name==s&&(n=e.phoneno.replace(/(^02.{0}|^01.{1}|[0-9]{3})([0-9]+)([0-9]{4})/,"$1-$2-$3"),a=e.email)})),$("#inst_info").append(`<tr>\n            <td class="info_name">기관명</td>\n            <td class="data">${t.name_ko} (${t.name_en})</td>\n            <td class="info_name">사업자 등록번호</td>\n            <td class="data">${t.business_num}</td>\n          </tr>\n          <tr>\n            <td class="info_name">행정 간사</td>\n            <td class="data">${t.user_name}</td>\n            <td class="info_name">연락처</td>\n            <td class="data">Tel: ${n}<br>Email: ${a}</td>\n          </tr>\n          <tr>\n            <td class="info_name">세금계산서 발행 여부</td>\n            <td colspan="3" class="data">${t.invoice_flag_str}</td>\n          </tr>`)}})}function getPaymentInfo(){let t=CONST.API.ORDERS.DETAIL,s=COMM.getStor("order_seq");$("#payment_info").empty(),API.load({url:t.replace("${order_seq}",s),type:CONST.API_TYPE.GET,success:function(t){let s="";"CARD"==t[0].pay_method?s="신용카드":"BANK"==t[0].pay_method&&(s="계좌이체");let n=!1,a=new Date,e=getDttm(a/1e3).dt.substring(0,7).replace("-","");n=Number(e)>=Number(t[0].the_date);let d=`<tr>\n                <td class="info_name">결제 내용</td>\n                <td class="data">${t[0].pname}</td>\n                <td class="info_name">\n                  <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" title="PG사 승인 번호 (한 번호에 승인, 취소가 모두 묶임)"></i>승인 번호</td>\n                <td class="data">${t[0].auth_code}</td>\n              </tr>\n              <tr class="blank_row"><td colspan="4"></td></tr>\n              <tr>\n                <td class="info_name">결제 구분</td>\n                <td class="data">${s} - <span class="approved fw_bold">승인</span></td>\n                <td class="info_name fw_bold">결제 금액</td>\n                <td>\n                  <span class="data approved fw_bold underline mRight5">${setComma(t[0].amount)}</span>원\n                </td>\n              </tr>\n              <tr>\n                <td class="info_name">\n                  <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" title="IPSAP에서 PG 모듈에 결제를 요청한 시간"></i>결제 일시</td>\n                <td class="data">${moment(t[0].pay_date,"YYYY-MM-DD hh:mm:ss").format("YYYY-MM-DD HH:mm:ss")}</td>\n                <td class="info_name">\n                  <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" title="PG사 모듈에서 승인이 완료된 시간"></i>승인 일시</td>\n                <td class="data">${moment(t[0].auth_date,"YY-MM-DD hh:mm:ss").format("YYYY-MM-DD HH:mm:ss")}</td>\n              </tr>\n              <tr>\n                <td class="info_name">\n                  <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" title="IPSAP 거래 번호 (행정간사가 확인 가능, 매번 새로 발행)"></i>결제 번호</td>\n                <td class="data">${t[0].moid}</td>\n                <td class="info_name">\n                  <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" title="PG사 거래 번호 (매번 새로 발행)"></i>거래 ID (TID)</td>\n                <td class="data">${t[0].tid}</td>\n              </tr>\n              <tr class="blank_row"><td colspan="4"></td></tr>\n              <tr>\n                <td class="info_name">결제 구분</td>\n                <td class="data">신용카드 - <span class="canceled fw_bold">전체 취소</span></td>\n                <td class="info_name fw_bold">취소 금액</td>\n                <td class="data fw_bold"><span class="canceled underline">${t[1].amount}</span><span class="subInfo mLeft5">원</span></td>\n              </tr>\n              <tr>\n                <td class="info_name">결제 일시</td>\n                <td class="data">${moment(t[1].pay_date,"YYYY-MM-DD hh:mm:ss").format("YYYY-MM-DD HH:mm:ss")}</td>\n                <td class="info_name">승인 취소 일시</td>\n                <td class="data">${moment(t[1].auth_date,"YY-MM-DD hh:mm:ss").format("YYYY-MM-DD HH:mm:ss")}</td>\n              </tr>\n              <tr>\n                <td class="info_name">결제 번호</td>\n                <td class="data">승인 결제와 동일</td>\n                <td class="info_name">거래 ID (TID)</td>\n                <td class="data">승인 결제와 동일</td>\n              </tr>\n              <tr class="blank_row"><td colspan="4"></td></tr>\n              <tr>\n                <td class="info_name">최종 결제 금액</td>\n                <td class="data"><span class="underline red fw_bold">0</span><span class="subInfo mLeft5">원</span></td>\n                <td class="info_name">\n                <i class="fas fa-question-circle red tippy-btn mRight5" data-tippy-placement="top-start" title="해당 이용권으로 서비스를 이용하는 기간"></i>이용 기간</td>\n                <td class="data">\n                이용전\n                </td>\n              </tr>`;$("#payment_info").append(d),$("#btn_certificate").attr("onclick",`printReceipt("${t[0].tid}")`)},complete:function(){tippy(".tippy-btn",{trigger:"mouseenter"})}})}function printReceipt(t){var s="https://npg.nicepay.co.kr/issue/IssueLoader.do?TID="+t+"&type=0";window.open(s,"popupIssue","toolbar=no,location=no,directories=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,width=420,height=540")}"undefined"==typeof ipsap_common_js&&document.write("<script src='/assets/js/ipsap/ipsap_common.js'><\/script>"),"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof date_utils_js&&document.write("<script src='/assets/js/common/util/date_utils.js'><\/script>"),$((function(){IPSAP.DEMO_MODE||(getInstInfo(),getPaymentInfo()),$(".card").removeClass("hidden")}));