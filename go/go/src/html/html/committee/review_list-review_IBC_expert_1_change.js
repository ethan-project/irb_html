var changeInfoTemplate,changeMemberTemplate,changeEndDateTemplate;"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof ipsap_item_module_js&&document.write("<script src='/assets/js/ipsap/ipsap_item_module.js'><\/script>"),document.write("<script src='/html/researcher/IBC/common_application_new-IBC.js'><\/script>");const member_is_seq=286,end_date_is_seq=288;function dataMappingFunc(e){{var t=(i=e.getItemData("judge_expert_deadline",!0)).getStringValue("0");if(""==t)return void alert("전문 심사 종료일 Error!!!");var a=new Date(t).getTime();function n(){var e=(new Date).getTime(),t=parseInt((a-e)/1e3);let n=getTimeStrFromSec(t);$(".timer").text(n),t>=0?$(".timer").parent().removeClass("timeout"):$(".timer").parent().addClass("timeout")}n(),setInterval((function(){n()}),1e3)}var i=e.getParentItemData("general_title");$("#name_ko").text(i.getStringValue("name_ko")),$("#name_en").text(i.getStringValue("name_en"));{i=e.getParentItemData("application_info");let A=Number(i.getStringValue("approved_dttm"));$("#approved_dttm").text(getDttm(A).dt)}i=e.getParentItemData("general_end_date");function r(e,t){for(let a=0;a<e.length;++a)if(e[a].is_seq==t)return e[a].contents;return"Error!!"}function d(e,t){for(let a=0;a<e.length;++a)if(e[a].file_idx==t)return e[a]}$("#general_end_date").text(i.getStringValue("0"));{var p=e.getItemData("ibc_ca_file");let C=(i=e.getItemData("ibc_ca_item")).dataObj.saved_data.data;for(const[y,N]of Object.entries(C)){let E=d(p.dataObj.saved_data.data,Number(y));var l=JSON.parse(N);let M={};var c=3;if(286==Number(y)){M=changeMemberTemplate.clone(),M.find(".data").eq(2).text(l[2]);var o=M.find(".data").find("tbody").eq(0),_=M.find(".data").find("tbody").eq(1),s=o.children("tr").eq(0),m=_.children("tr").eq(0);M.find(".data").find("tbody").empty();var g=[],f=e.getParentItemData("general_director");g.push(f.dataObj.saved_data.data[0]);for(var u=f.dataObj.saved_data.data[0].user_seq,h=e.getParentItemData("general_expt"),v=0;v<Object.keys(h.dataObj.saved_data.data).length;v++)g.push(h.dataObj.saved_data.data[v]);$.each(g,(function(e,t){let a="";if(t.edu_course){let n=JSON.parse(t.edu_course);for(e in n)a+=`\n              <div class="flexMid">\n                <span class="w120 mRight5">${e}</span>\n                <div>${n[e]}</div>\n              </div>`}var n=s.clone(),i=t.info;u==t.user_seq?n.children("td").eq(0).find("input").prop("checked",!0):(n.children("td").eq(0).find("input").prop("checked",!1),n.children("td").eq(0).find("input").prop("disabled",!0)),1==t.animal_mng_flag?n.children("td").eq(1).find("input").prop("checked",!0):(n.children("td").eq(1).find("input").prop("checked",!1),n.children("td").eq(1).find("input").prop("disabled",!0)),n.children("td").eq(2).text(i.name),n.children("td").eq(3).text(i.dept_str),n.children("td").eq(4).append(a),o.append(n)}));var q=[],I=e.getItemData("general_director");q.push(I.dataObj.saved_data.data[0]);var b=I.dataObj.saved_data.data[0].user_seq,x=e.getItemData("general_expt");for(v=0;v<Object.keys(x.dataObj.saved_data.data).length;v++)q.push(x.dataObj.saved_data.data[v]);$.each(q,(function(e,t){let a="";if(t.edu_course){let n=JSON.parse(t.edu_course);for(e in n)a+=`\n              <div class="flexMid">\n                <span class="w120 mRight5">${e}</span>\n                <div>${n[e]}</div>\n              </div>`}var n=m.clone(),i=t.info;b==t.user_seq?n.children("td").eq(0).find("input").prop("checked",!0):(n.children("td").eq(0).find("input").prop("checked",!1),n.children("td").eq(0).find("input").prop("disabled",!0)),1==t.animal_mng_flag?n.children("td").eq(1).find("input").prop("checked",!0):(n.children("td").eq(1).find("input").prop("checked",!1),n.children("td").eq(1).find("input").prop("disabled",!0)),n.children("td").eq(2).text(i.name),n.children("td").eq(3).text(i.dept_str),n.children("td").eq(4).append(a),_.append(n)}))}else if(288==Number(y)){M=changeEndDateTemplate.clone();var S=e.getParentItemData("application_info");let R=getTimeStrFromDateType(new Date(getDttm(Number(S.getStringValue("approved_dttm"))).dt));var w=e.getParentItemData("general_end_date"),O=getTimeStrFromDateType(new Date(w.getStringValue("0"))),D=e.getItemData("general_end_date"),j=getTimeStrFromDateType(new Date(D.getStringValue("0")));M.find(".data").eq(2).text(R+"~"+O),M.find(".data").eq(3).text(R+"~"+j),M.find(".data").eq(4).text(l[2]),c=5}else M=changeInfoTemplate.clone(),M.find("label").eq(0).text(r(i.dataObj.codes,Number(y))),M.find(".data").eq(1).text(l[1]),M.find(".data").eq(2).text(l[2]);null==E?M.find(".data").eq(c).text(""):(M.find(".data").eq(c).text(E.org_file_name),M.find(".data").eq(c).attr("href",E.src));var T=`newWindowPopup('/html/committee/IBC/_popup_app-IBC_info_all.html#form_${l[0]}')`;M.find("a").first().attr("onclick",T),M.find("a").eq(0).empty();var P=`<i class="fas fa-link mRight5"></i>심의 신청서 : ${IPSAP.IBC_MAIN_TAGE_NAME[l[0]]}`;M.find("a").eq(0).append(P),$("#change_application").append(M)}}$(".agree_date").text(getDate(g_AppInfo.appObj.submit_dttm)),$(".reviewer").text(spaceAddStr(g_AppInfo.appObj.user_name)),(i=e.getItemData("expert_review_total_review")).applyTextValue(),(i=e.getItemData("expert_review_result")).makeHtmlRadioType();var k=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)).name;$(".agree_date").eq(1).text(getToDayStr()),$(".reviewer").eq(1).text(spaceAddStr(k)),$(".card").removeClass("hidden")}function onClickExpertReviewFinishSubmit(){if(!$("#check_01").is(":checked"))return alert("제출 동의를 확인해 주세요."),void $("#check_01").focus();g_AppItemParser.targetSavedItemNames=["expert_review_result","expert_review_total_review"];var e=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)),t={};t[String(e.user_seq)]=Math.floor((new Date).getTime()/1e3),g_AppItemParser.addMoreSaveTag("expert_review_dttm",{data:t}),appItemSubmit(onCompleteExpertReviewOpinionSubmit,IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_PRO_2)}function onCompleteExpertReviewOpinionSubmit(e,t,a){e?window.location.href="./review_list.html":($("#modal_finish_review").modal("hide"),appSubmitHandleError("전문 심사 완료를 실패했습니다.",t))}$((function(){loadApplicationParams();changeInfoTemplate=$("#change_application").children("ul").eq(0).clone(),changeMemberTemplate=$("#change_application").children("ul").eq(1).clone(),changeEndDateTemplate=$("#change_application").children("ul").eq(2).clone(),$("#change_application").empty(),$("#change_application").removeClass("hidden"),g_AppItemParser=new ItemParser(g_AppInfo.childAppSeq),g_AppItemParser.load({"filter.query_items":"ibc_change_application,judge_expert_deadline,expert_review_result,expert_review_total_review","filter.parent_items":"general_title,general_end_date,application_info,general_director,general_expt,ibc_general_experiment"},dataMappingFunc)}));