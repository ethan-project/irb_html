var changeInfoTemplate,changeMemberTemplate,changeEndDateTemplate;"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof ipsap_item_module_js&&document.write("<script src='/assets/js/ipsap/ipsap_item_module.js'><\/script>"),document.write("<script src='/html/researcher/IBC/common_application_new-IBC.js'><\/script>");const member_is_seq=286,end_date_is_seq=288;function dataMappingFunc(e){{var t=e.getItemData("judge_expert_deadline",!0).getStringValue("0");if(""==t)return void alert("전문 심사 종료일 Error!!!");var a=e.getItemData("judge_normal_deadline",!0).getStringValue("0");if(""==a)return void alert("일반 심사 종료일 Error!!!");var r=a,n="H";if(a.length>1){r=a.substring(0,a.length-1);n=a.slice(-1)}0==r&&(r=7);var d=new Date(t).getTime();function i(){var e=(new Date).getTime(),t=parseInt((d-e)/1e3);let a=getTimeStrFromSec(t);$(".timer").text(a),t>=0?$(".timer").parent().removeClass("timeout"):$(".timer").parent().addClass("timeout")}d+="H"==n?3600*r*1e3:86400*r*1e3,i(),setInterval((function(){i()}),1e3)}var p=e.getParentItemData("general_title");$("#name_ko").text(p.getStringValue("name_ko")),$("#name_en").text(p.getStringValue("name_en"));{p=e.getParentItemData("application_info");let F=Number(p.getStringValue("approved_dttm"));$("#approved_dttm").text(getDttm(F).dt)}p=e.getParentItemData("general_end_date");function l(e,t){for(let a=0;a<e.length;++a)if(e[a].is_seq==t)return e[a].contents;return"Error!!"}function _(e,t){for(let a=0;a<e.length;++a)if(e[a].file_idx==t)return e[a]}$("#general_end_date").text(p.getStringValue("0"));{var s=e.getItemData("ibc_ca_file");let V=(p=e.getItemData("ibc_ca_item")).dataObj.saved_data.data;for(const[B,J]of Object.entries(V)){let H=_(s.dataObj.saved_data.data,Number(B));var c=JSON.parse(J);let L={};var o=3;if(286==Number(B)){L=changeMemberTemplate.clone(),L.find(".data").eq(2).text(c[2]);var m=L.find(".data").find("tbody").eq(0),g=L.find(".data").find("tbody").eq(1),u=m.children("tr").eq(0),f=g.children("tr").eq(0);L.find(".data").find("tbody").empty();var v=[],h=e.getParentItemData("general_director");v.push(h.dataObj.saved_data.data[0]);for(var b=h.dataObj.saved_data.data[0].user_seq,q=e.getParentItemData("general_expt"),I=0;I<Object.keys(q.dataObj.saved_data.data).length;I++)v.push(q.dataObj.saved_data.data[I]);$.each(v,(function(e,t){let a="";if(t.edu_course){let r=JSON.parse(t.edu_course);for(e in r)a+=`\n              <div class="flexMid">\n                <span class="w120 mRight5">${e}</span>\n                <div>${r[e]}</div>\n              </div>`}var r=u.clone(),n=t.info;b==t.user_seq?r.children("td").eq(0).find("input").prop("checked",!0):(r.children("td").eq(0).find("input").prop("checked",!1),r.children("td").eq(0).find("input").prop("disabled",!0)),1==t.animal_mng_flag?r.children("td").eq(1).find("input").prop("checked",!0):(r.children("td").eq(1).find("input").prop("checked",!1),r.children("td").eq(1).find("input").prop("disabled",!0)),r.children("td").eq(2).text(n.name),r.children("td").eq(3).text(n.dept_str),r.children("td").eq(4).append(a),m.append(r)}));var x=[],S=e.getItemData("general_director");x.push(S.dataObj.saved_data.data[0]);var O=S.dataObj.saved_data.data[0].user_seq,w=e.getItemData("general_expt");for(I=0;I<Object.keys(w.dataObj.saved_data.data).length;I++)x.push(w.dataObj.saved_data.data[I]);$.each(x,(function(e,t){let a="";if(t.edu_course){let r=JSON.parse(t.edu_course);for(e in r)a+=`\n              <div class="flexMid">\n                <span class="w120 mRight5">${e}</span>\n                <div>${r[e]}</div>\n              </div>`}var r=f.clone(),n=t.info;O==t.user_seq?r.children("td").eq(0).find("input").prop("checked",!0):(r.children("td").eq(0).find("input").prop("checked",!1),r.children("td").eq(0).find("input").prop("disabled",!0)),1==t.animal_mng_flag?r.children("td").eq(1).find("input").prop("checked",!0):(r.children("td").eq(1).find("input").prop("checked",!1),r.children("td").eq(1).find("input").prop("disabled",!0)),r.children("td").eq(2).text(n.name),r.children("td").eq(3).text(n.dept_str),r.children("td").eq(4).append(a),g.append(r)}))}else if(288==Number(B)){L=changeEndDateTemplate.clone();var j=e.getParentItemData("application_info");let U=getTimeStrFromDateType(new Date(getDttm(Number(j.getStringValue("approved_dttm"))).dt));var D=e.getParentItemData("general_end_date"),T=getTimeStrFromDateType(new Date(D.getStringValue("0"))),P=e.getItemData("general_end_date"),A=getTimeStrFromDateType(new Date(P.getStringValue("0")));L.find(".data").eq(2).text(U+"~"+T),L.find(".data").eq(3).text(U+"~"+A),L.find(".data").eq(4).text(c[2]),o=5}else L=changeInfoTemplate.clone(),L.find("label").eq(0).text(l(p.dataObj.codes,Number(B))),L.find(".data").eq(1).text(c[1]),L.find(".data").eq(2).text(c[2]);null==H?L.find(".data").eq(o).text(""):(L.find(".data").eq(o).text(H.org_file_name),L.find(".data").eq(o).attr("href",H.src));var N=`newWindowPopup('/html/committee/IBC/_popup_app-IBC_info_all.html#form_${c[0]}')`;L.find("a").first().attr("onclick",N),L.find("a").eq(0).empty();var k=`<i class="fas fa-link mRight5"></i>심의 신청서 : ${IPSAP.IBC_MAIN_TAGE_NAME[c[0]]}`;L.find("a").eq(0).append(k),$("#change_application").append(L)}}$(".agree_date").eq(0).text(getDate(g_AppInfo.appObj.submit_dttm)),$(".reviewer").eq(0).text(spaceAddStr(g_AppInfo.appObj.user_name)),(p=e.getItemData("expert_review_total_review")).applyTextValueReadOnly();{p=e.getItemData("expert_review_result");let G=Number(p.dataObj.saved_data.data[0].select_ids[0]),K="";try{K=p.dataObj.saved_data.data[0].inputs[String(G)][1]}catch(Y){}let W="";for(let z=0;z<p.dataObj.items.length;++z)if(p.dataObj.items[z].id==G){W=p.dataObj.items[z].value;break}$("#expert_review_result").text(W),""!=K?$("#expert_review_result_text").text(K):$("#expert_review_result_text").remove()}{var y=(p=e.getItemData("expert_member")).dataObj.saved_data.data[0].info.name;$(".reviewer").eq(1).text(spaceAddStr(y));var C=p.dataObj.saved_data.data[0].user_seq,M=e.getItemData("expert_review_dttm");const Q=new Date(1e3*M.dataObj.saved_data.data[String(C)]);$(".agree_date").eq(1).text(getTimeStrFromDateType(Q))}var E=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO));(p=e.getItemData("normal_review_result")).makeHtmlRadioType(IPSAP.COL.ALL,E.user_seq);var R=E.name;$(".agree_date").eq(2).text(getToDayStr()),$(".reviewer").eq(2).text(spaceAddStr(R)),$(".card").removeClass("hidden")}function onClickNormalReviewFinishSubmit(){if(!$("#check_11").is(":checked"))return alert("제출 동의를 확인해 주세요."),void $("#check_11").focus();g_AppItemParser.targetSavedItemNames=["normal_review_result"];var e=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)),t={};t[String(e.user_seq)]=Math.floor((new Date).getTime()/1e3),g_AppItemParser.addMoreSaveTag("normal_review_dttm",{data:t}),appItemSaveTemporary(onCompleteNormalReviewSubmit,IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_NORMAL)}function onCompleteNormalReviewSubmit(e,t,a){e?window.location.href="./review_list.html":appSubmitHandleError("일반 심사를 완료할 수 없습니다.",t)}$((function(){loadApplicationParams();changeInfoTemplate=$("#change_application").children("ul").eq(0).clone(),changeMemberTemplate=$("#change_application").children("ul").eq(1).clone(),changeEndDateTemplate=$("#change_application").children("ul").eq(2).clone(),$("#change_application").empty(),$("#change_application").removeClass("hidden"),g_AppItemParser=new ItemParser(g_AppInfo.childAppSeq),g_AppItemParser.load({"filter.query_items":"ibc_change_application,judge_expert_deadline,expert_member,expert_review_total_review,expert_review_result,expert_review_dttm,judge_normal_deadline,normal_review_result","filter.parent_items":"general_title,general_end_date,application_info,general_director,general_expt"},dataMappingFunc)}));