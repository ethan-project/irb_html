"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof ipsap_item_module_js&&document.write("<script src='/assets/js/ipsap/ipsap_item_module.js'><\/script>"),document.write("<script src='/html/researcher/IBC/common_application_new-IBC.js'><\/script>");var g_main_id_arr=[];function mappingExpertReviewOpinion(e){{var t=(n=e.getItemData("judge_expert_deadline")).getStringValue("0");if(""==t)return void alert("전문 심사 종료일 Error!!!");var i=new Date(t).getTime();function a(){var e=(new Date).getTime(),t=parseInt((i-e)/1e3);let a=getTimeStrFromSec(t);$(".timer").text(a),t>=0?$(".timer").parent().removeClass("timeout"):$(".timer").parent().addClass("timeout")}a(),setInterval((function(){a()}),1e3)}var n=e.getItemData("expert_review_opinion"),r=$(".focus_area").first().parent(),o=$(".focus_area").first().clone();$(".focus_area").remove();var s=n.dataObj.codes;for(let f=0;f<s.length;++f){var d="00"+String(f+1);let g="#form_"+(d=d.slice(-2)),w="ins_check_"+s[f].is_seq;g_main_id_arr.push(s[f].is_seq);let b="ins_"+s[f].is_seq+"-group",k="."+b,x="ins_input_"+s[f].is_seq;var l=o.clone();l.attr("data-focus-to",g);var p=l.children("li").first().clone(),c=l.children("li").eq(1).clone(),m=l.children("li").last().clone();l.children("li").remove();{p.attr("data-move-to",g+"-1");let y=p.children("span").children("span").clone().wrapAll("<div/>").parent().html();p.children("span").html(s[f].contents+y),p.children("div").children("label").attr("for",w),p.children("div").children("div").children("input").attr("id",w),p.children("div").children("div").children("input").attr("data-target",k),p.children("div").children("div").children("label").attr("for",w),l.append(p)}var _=s[f].sub_items;for(let C=0;C<_.length;++C){var h=c.clone();let I="ins_check_"+_[C].is_seq;h.removeClass("ins_01-group"),h.addClass(b),h.children("div").children("input").attr("name",I),h.children("div").children("input").attr("id",I),h.children("div").children("input").attr("value",_[C].is_seq),h.children("div").children("label").attr("for",I),h.children("label").attr("for",I),h.children("label").text(_[C].contents),l.append(h)}m.removeClass("ins_01-group"),m.addClass(b),m.children("textarea").attr("id",x),l.append(m),r.append(l);try{let S=n.dataObj.saved_data.data[s[f].is_seq];var v=JSON.parse(S),u=Object.keys(n.dataObj.saved_data.data);for(let O=0;O<v.select.length;++O){let j="ins_check_"+v.select[O];$("#"+j).prop("checked",!0)}$("#"+x).val(v.text)}catch(q){}}setTriggerDataMoveTo(),$(".card").removeClass("hidden");for(let A=0;A<s.length;++A){let E="ins_check_"+s[A].is_seq,R="."+("ins_"+s[A].is_seq+"-group");null!=u&&(isInArray(u,s[A].is_seq.toString())?$("#"+E).prop("checked",!1):($("#"+E).prop("checked",!0),$(R).removeClass("show"),$(R).addClass("collapse")))}}function cbFuncAfterMapping(e){mappingExpertReviewOpinion(e),originalJSFunction(),resetLeftStepNaviIcon(),$(".sub-check").on("change",(function(){resetLeftStepNaviIcon()})),$(".sub-input").on("keyup",(function(){resetLeftStepNaviIcon()})),$(".main-check").on("change",(function(){resetLeftStepNaviIcon()}))}function originalJSFunction(){var e=!0;$(".modal.draggable>.modal-dialog").draggable({drag:function(e,t){t.position.top<=0&&(t.position.top=0),t.position.top>=window.innerHeight-80&&(t.position.top=window.innerHeight-80)},cursor:"move",handle:".modal-header"}),$(".modal.draggable>.modal-dialog>.modal-content>.modal-header").css("cursor","move"),$(".modal.draggable>.modal-dialog").on({"click drag":function(t){$(".modal_hint").hide(),e&&($(".modal[data-backdrop=false]").css({"background-color":"rgba(0,0,0, 0.0)","pointer-events":"none"}),$(".modal-dialog-centered.ui-draggable").css({"justify-content":"flex-start"}),"click"==t.type&&$(this).css({"margin-right":"0",left:"0",top:"0"})),e=!1}}),$(".modal.fade").each((function(e,t){$(t).hasClass("in")&&$(t).modal("show"),"modal_expertReview"==$(t).attr("id")&&$("body").css({overflow:"auto"})})),$("[data-focus-to]").on({mouseenter:function(e){let t=$(this),i=$(this).data("focus-to");t.siblings(".list-group").removeClass("active"),$(".app_header").removeClass("active"),t.addClass("active"),$(i).next(".content_wrapper").length?$(i).next(".content_wrapper").find(".app_header").addClass("active"):$(i).nextUntil(".app_anchor").filter(".app_header").addClass("active")}}),$("#review_summary").on({click:e=>{var t=$(e.currentTarget),i=t.closest(".modal");t.toggleClass("active"),t.hasClass("active")?t.text("항목별 전문 심사 계속하기"):t.text("전문 심사의견 모아보기"),i.find("input").prop("disabled",!0),i.find("textarea").prop("readonly",!0),i.find(".custom-switch").find("input:checkbox").prop({disabled:!0,checked:!0});let a=$(".list-group-item.show");if(t.hasClass("active"))i.addClass("view_mode"),a.filter(((e,t)=>!$(t).find("input").prop("checked")||(!$(t).parent().children().find("textarea").length||""==$(t).parent().children().find("textarea").val()||($(t).parent().children().find(".custom-switch").find("input:checkbox").prop("checked",!1),!1)))).hide(),$(".focus_area").filter(((e,t)=>{if(!$(t).find(".list-group-item.show").length)return!0;$(t).css({"margin-top":"10px","margin-bottom":"10px"}),$(t).addClass("view_mode"),""!=$(t).find("textarea").val()&&$(t).find(".sub-check").is(":checked")?$(t).find(".hovered").css({display:"block"}):$(t).find(".hovered").css({display:"none"})})).css({"margin-top":"","margin-bottom":"10px"});else{let e=i.find(".focus_area.view_mode");i.removeClass("view_mode"),i.find("input").prop("disabled",!1),i.find("textarea").prop("readonly",!1),e.find(".custom-switch").find("input:checkbox").prop("checked",!1),a.show(),a.parent().find(".hovered").removeAttr("style"),$(".focus_area").removeClass("view_mode").css({"margin-top":"","margin-bottom":""})}resetLeftStepNaviIcon()}}),$(".continue").on({click:function(e){$("#modal_expertReview").modal("show")}})}function resetLeftStepNaviIcon(){for(var e=0;e<g_main_id_arr.length;e++){let i="#ins_check_"+g_main_id_arr[e],a="#ins_input_"+g_main_id_arr[e];var t=$(i).is(":checked");let n=$(`.process_content[data-process-num='${e+1}']`);n.removeClass("completed pending supplement"),t?n.addClass("completed"):(n.addClass("pending"),""!=$(a).val()&&n.addClass("supplement"))}$(".process_content").each(((e,t)=>{$(t).data("offset")&&$(t).data("offset"),$(t).data("tippy-target")&&$(t).data("tippy-target").split(",");$(t).on({mouseenter:function(e){let t=this,i=$(this);void 0!==t._tippy&&(t._tippy.destroy(),$(".tippy-popper").remove()),i.attr({"data-tippy-animation":"shift-away","data-tippy-placement":"top-end","data-tippy-arrow":!0,"data-tippy-size":"small","data-tippy-theme":""}),i.hasClass("supplement")?(i.attr({title:"심사의견이 있습니다.","data-tippy-theme":""}),tippy(t)):i.hasClass("pending")&&(i.attr({title:"심사의견 입력이 필요합니다.","data-tippy-theme":"pending"}),tippy(t))},mouseleave:function(e){let t=this,i=$(this);void 0!==t._tippy&&(t._tippy.destroy(),$(".tippy-popper").remove()),i.removeAttr("title")}})}))}function makeExpertReviewOpinionData(){var e={},t=g_AppItemParser.getItemData("expert_review_opinion").dataObj.codes,i=!1;for(let n=0;n<t.length;++n){let r="ins_check_"+t[n].is_seq,o="ins_input_"+t[n].is_seq;if($("#"+r).is(":checked"))continue;let s=[];for(let e=0;e<t[n].sub_items.length;++e){let i="ins_check_"+t[n].sub_items[e].is_seq;$("#"+i).is(":checked")&&s.push(t[n].sub_items[e].is_seq)}if(0==s.length){i=!0;break}var a=$("#"+o).val();if(""==a){i=!0;break}value=JSON.stringify({select:s,text:a}),e[t[n].is_seq]=value}return!i&&{data:e}}function onClickExpertReviewOpinionSubmit(){IPSAP.DEMO_MODE?window.location.href="./review_list-review_IBC_expert_2.html":(g_AppItemParser.targetSavedItemNames=[],g_AppItemParser.addMoreSaveTag("expert_review_opinion",makeExpertReviewOpinionData()),appItemSubmit(onCompleteExpertReviewOpinionSubmit,IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_PRO))}function onCompleteExpertReviewOpinionSubmit(e,t,i){e?window.location.href="./review_list-review_IBC_expert_2.html":appSubmitHandleError("항목별 전문 심사 완료를 실패했습니다.",t)}$((function(){loadApplicationParams();$(".page-contents");$("#all_app_r").empty(),$("#all_app_r").load("/html/common/inc_application/all_app_readonly_ibc.html",(function(){remakeApplicationInfoReadOnly(["expert_review_opinion","judge_expert_deadline"],cbFuncAfterMapping)})),$(".modal_review").on({click:function(e){validation=makeExpertReviewOpinionData(),validation?$(".modal_review").attr("data-target","#modal_review_confirm"):$(".modal_review").attr("data-target","#modal_input_alert")}})})),$("#modal_expertReview").on("hidden.bs.modal",(e=>{$(e.currentTarget).modal("show")}));