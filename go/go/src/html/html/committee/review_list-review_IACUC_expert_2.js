var g_trTemplete;"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof ipsap_item_module_js&&document.write("<script src='/assets/js/ipsap/ipsap_item_module.js'><\/script>"),document.write("<script src='../researcher/application_new-0.js'><\/script>");var user_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)),inst_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_INST_INFO));function originalJSFunction(e){ratingEnable($(".rating_point")),sumPoint($("select.rating_point")),sumAccount($("select.rating_pass")),$("select.rating_point").on({change:function(e){sumPoint($("select.rating_point"))}}),$("select.rating_pass").on({change:function(e){sumAccount($("select.rating_pass"))}}),$("a.rating_pass").on({click:function(e){$(this).siblings().removeClass("active"),$(this).addClass("active"),$(this).parent().siblings("select").val($(this).data("value")).trigger("change")}})}function sumPoint(e){var t=0,a="fail";return e.each((function(e,a){if(!$(a).val())return 0;t+=parseInt($(a).val())})),a=t>=parseInt(inst_info.ia_base_score)?"pass":a,$("#total_sum").html(`<span class="${a}">${t}</span> / 100`),t}function sumAccount(e){var t=0,a="fail";return e.each((function(e,a){if(!$(a).val())return 0;t+=parseInt($(a).val())})),a=t>=parseInt(inst_info.ia_base_item)?"pass":a,$("#total_account").html(`<span class="${a}">${t}</span> / 10`),t}function dataMappingFunc(e){{var t=e.getItemData("judge_expert_deadline",!0).getStringValue("0");if(""==t)return void alert("전문 심사 종료일 Error!!!");var a=new Date(t).getTime();function i(){var e=(new Date).getTime(),t=parseInt((a-e)/1e3);let i=getTimeStrFromSec(t);$(".timer").text(i),t>=0?$(".timer").parent().removeClass("timeout"):$(".timer").parent().addClass("timeout")}i(),setInterval((function(){i()}),1e3)}e.getItemData("expert_review_total_review").applyTextValue(),e.getItemData("expert_review_result").makeHtmlRadioType();var n=e.getItemData("expert_review_opinion",!0),r=e.getItemData("expert_review_evaluation",!0);let s=$(".list_table").find("tbody"),l=!0,o=r.dataObj.codes;for(let d=0;d<o.length;++d){let u=g_trTemplete.clone();u.children("td").eq(0).text(o[d].contents);let v=u.children("td").eq(1),m=v.children("ul").children("li").first().clone();v.children("ul").empty();for(let g=0;g<o[d].sub_items.length;++g){let h=m.clone();h.text(o[d].sub_items[g].contents),v.children("ul").append(h)}try{let w=n.dataObj.saved_data.data[o[d].is_seq];var _=JSON.parse(w);let O=u.children("td").eq(2);O.empty();let I="";for(let b=0;b<_.select.length;++b){let P=_.select[b],S=n.dataObj.codes[d].sub_items;for(let E=0;E<S.length;++E)if(P==S[E].is_seq){""!=I&&(I+="<br>"),I+=S[E].contents;break}}O.removeClass("noComment"),O.append(`<div class="review_numbers">${I}</div>`),O.append(`<div class="review_desc text-wrap">${_.text}</div>`)}catch(x){}let f=u.children("td").eq(3);if(f.hasClass("evaluation_score")){let A=`review_point_${o[d].is_seq}`;f.children("select").attr("name",A)}else{let C=`review_pass_${o[d].is_seq}`;f.children("select").attr("name",C),l=!1}s.append(u),$(".card").removeClass("hidden")}originalJSFunction();for(let T=0;T<o.length;++T)if(l){let N=`review_point_${o[T].is_seq}`;try{let D=r.dataObj.saved_data.data[o[T].is_seq];D<2&&(D=2);var c=$(`select[name=${N}]`),p=c.parent().children("div").children("a");for(let M=0;M<p.length;M++)p.eq(M).data("rating-value")==D?(p.eq(M).addClass("br-selected br-current"),c.val(D).prop("selected",!0)):(p.eq(M).removeClass("br-selected br-current"),c.val(D).prop("selected",!1))}catch(q){}}else{let k=`review_pass_${o[T].is_seq}`;try{r.dataObj.saved_data.data[o[T].is_seq]>0?$(`select[name=${k}]`).parent().children("div").children("a.rating_pass[data-value=1]").click():$(`select[name=${k}]`).parent().children("div").children("a.rating_pass[data-value=0]").click()}catch(y){}}sumPoint($("select.rating_point")),sumAccount($("select.rating_pass"))}function makeExpertReviewEvalutionData(){var e={};let t=g_AppItemParser.getItemData("expert_review_evaluation",!0).dataObj.codes;for(let a=0;a<t.length;++a){let i=`review_point_${t[a].is_seq}`;if($(`select[name=${i}]`).length>0){let n=$(`select[name=${i}]`).parent().children("div").children("a.br-current").attr("data-rating-value");Number(n)>2&&(e[t[a].is_seq]=n)}else{let i=`review_pass_${t[a].is_seq}`,n=$(`select[name=${i}]`).parent().children("div").children("a.active").attr("data-value");Number(n)>0&&(e[t[a].is_seq]=n)}}return{data:e}}function onClickExpertReviewFinishSubmit(){if($("#modal_finish_review").modal("hide"),!$("#check_01").is(":checked"))return alert("제출 동의를 확인해 주세요."),void $("#check_01").focus();if(IPSAP.DEMO_MODE)window.location.href="./review_list.html";else{var e=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)),t={};t[String(e.user_seq)]=Math.floor((new Date).getTime()/1e3),g_AppItemParser.addMoreSaveTag("expert_review_dttm",{data:t}),g_AppItemParser.addMoreSaveTag("expert_review_evaluation",makeExpertReviewEvalutionData()),appItemSubmit(onCompleteExpertReviewOpinionSubmit,IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_PRO_2)}}function onCompleteExpertReviewOpinionSubmit(e,t,a){e?window.location.href="./review_list.html":($("#modal_finish_review").modal("hide"),appSubmitHandleError("전문 심사 완료를 실패했습니다.",t))}function setAgreeDate(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),n=t+"년 "+(a=a>=10?a:"0"+a)+"월 "+(i=i>=10?i:"0"+i)+"일";$(".agree_date").text(n)}function setExpertName(){var e=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)).name;$(".reviewer").text(e)}function onClickExpertPass(){$(".br-widget > a[data-rating-value=10]").click(),$("select.rating_point").val(10),$(".rating_pass > a[data-value=1]").click(),$("select.rating_pass").val(1),""==$("#expert_review_total_review").val()&&$("#expert_review_total_review").val("전문심사 과정 없이 다음 과정으로 이동합니다."),""==$("#expert_review_result_0_1_input_1").val()&&$("#expert_review_result_0_1_input_1").val("전문심사 과정 없이 다음 과정으로 이동합니다."),onClickExpertReviewFinishSubmit()}$((function(){loadApplicationParams(),function(e){if(IPSAP.DEMO_MODE)originalJSFunction();else{inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.SCORE?($(".evaluation_yn").remove(),$("#pass_criteria").find("span.underline").eq(1).css("display","none"),$(".pass_point").text(inst_info.ia_base_score)):inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.YN?($(".evaluation_score").remove(),$("#pass_criteria").find("span.underline").eq(0).css("display","none"),$(".pass_count").text(inst_info.ia_base_item)):inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.NONE?($(".evaluation_score").remove(),$(".evaluation_yn").remove(),e.find("tfoot").find(".text-right").text(""),$(".red_box").remove()):alert("Error!!!");let t=$(".list_table").find("tbody");g_trTemplete=t.children("tr").first().clone(),t.empty();let a={"filter.query_items":"expert_review_opinion,expert_review,judge_expert_deadline"};g_AppItemParser=new ItemParser(g_AppInfo.appSeq),g_AppItemParser.load(a,dataMappingFunc),$('[data-target="#modal_finish_review"]').on("click",(function(){var e=$('input:radio[name="expert_review_result_0"]:checked').val();if(inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.SCORE){var t=sumPoint($("select.rating_point"));if(inst_info.ia_base_score>t&&(1==e||2==e))return alert(`본 기관의 승인 또는 조건부 승인의 기준은 적합 ${inst_info.ia_base_score}점 이상 입니다.`),!1}else if(inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.YN){t=sumAccount($("select.rating_pass"));if(inst_info.ia_base_item>t&&(1==e||2==e))return alert(`본 기관의 승인 또는 조건부 승인의 기준은 적합 ${inst_info.ia_base_item}개 항목 이상 입니다.`),!1}if(""==$('input:radio[name="expert_review_result_0"]:checked').siblings().closest("input").val())return alert("전문 심사 최종 결과를 한 글자 이상 반드시 입력해주세요."),!1}))}setAgreeDate(),setExpertName()}($(".page-content")),user_info.user_type[1]||user_info.user_type[5]?$("#btnPass, #pass_comment").removeClass("hidden"):$("#btnPass, #pass_comment").remove()}));