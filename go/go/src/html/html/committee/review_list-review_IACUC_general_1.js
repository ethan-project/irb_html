var g_trTemplete;"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof ipsap_item_module_js&&document.write("<script src='/assets/js/ipsap/ipsap_item_module.js'><\/script>"),document.write("<script src='../researcher/application_new-0.js'><\/script>");var user_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)),inst_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_INST_INFO));function originalJSFunction(e){$(".rating_point").each((function(e,t){let a=$(t).val()?$(t).val():null;ratingEnable($(t),a,!0)})),sumPoint($("select.rating_point")),sumAccount($("select.rating_pass")),$("select.rating_point").on({change:function(e){sumPoint($("select.rating_point"))}}),$("select.rating_pass").on({change:function(e){sumAccount($("select.rating_pass"))}}),$("a.rating_pass").on({click:function(e){$(this).siblings().removeClass("active"),$(this).addClass("active"),$(this).parent().siblings("select").val($(this).data("value")).trigger("change")}})}function sumPoint(e){var t=0,a="fail";e.each((function(e,a){if(!$(a).val())return 0;t+=parseInt($(a).val())})),a=t>=parseInt(inst_info.ia_base_score)?"pass":a,$("#total_sum").html(`<span class="${a}">${t}</span> / 100`)}function sumAccount(e){var t=0,a="fail";e.each((function(e,a){if(!$(a).val())return 0;t+=parseInt($(a).val())})),a=t>=parseInt(inst_info.ia_base_item)?"pass":a,$("#total_account").html(`<span class="${a}">${t}</span> / 10`)}function dataMappingFunc(e){{var t=(_=e.getItemData("expert_member")).dataObj.saved_data.data[0].info.name;$("#experter").text(spaceAddStr(t));var a=_.dataObj.saved_data.data[0].user_seq,i=e.getItemData("expert_review_dttm");if(""==i)return void alert("전문 심사 제출일 Error!!!");const h=new Date(1e3*i.dataObj.saved_data.data[String(a)]);$("#expert_submit_date").text(getTimeStrFromDateType(h));var r=e.getItemData("judge_normal_deadline",!0).getStringValue("0");if(""==r)return void alert("일반 심사 종료일 Error!!!");var n=r,s="H";if(r.length>1){n=r.substring(0,r.length-1);s=r.slice(-1)}0==n&&(n=7);var l=h.getTime();function o(){var e=(new Date).getTime(),t=parseInt((l-e)/1e3);let a=getTimeStrFromSec(t);$(".timer").text(a),t>=0?$(".timer").parent().removeClass("timeout"):$(".timer").parent().addClass("timeout")}l+="H"==s?3600*n*1e3:86400*n*1e3,o(),setInterval((function(){o()}),1e3)}(_=e.getItemData("expert_review_total_review")).applyTextValueReadOnly();{var _=e.getItemData("expert_review_result");let O=Number(_.dataObj.saved_data.data[0].select_ids[0]),S="";try{S=_.dataObj.saved_data.data[0].inputs[String(O)][1]}catch(I){}let b="";for(let w=0;w<_.dataObj.items.length;++w)if(_.dataObj.items[w].id==O){b=_.dataObj.items[w].value;break}$("#expert_review_result").text(b),""!=S?$("#expert_review_result_text").text(S):$("#expert_review_result_text").remove()}var c=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO));(_=e.getItemData("normal_review_result")).makeHtmlRadioType(IPSAP.COL.ALL,c.user_seq);{const P=new Date;$("#normal_submit_date").text(getTimeStrFromDateType(P)),$("#submiter").text(spaceAddStr(c.name))}let d,m=!0;{var p=e.getItemData("expert_review_opinion",!0),u=e.getItemData("expert_review_evaluation",!0);let A=$(".list_table").find("tbody");d=u.dataObj.codes;for(let C=0;C<d.length;++C){let x=g_trTemplete.clone();x.children("td").eq(0).text(d[C].contents);let N=x.children("td").eq(1),T=N.children("ul").children("li").first().clone();N.children("ul").empty();for(let j=0;j<d[C].sub_items.length;++j){let D=T.clone();D.text(d[C].sub_items[j].contents),N.children("ul").append(D)}try{let M=p.dataObj.saved_data.data[d[C].is_seq];var v=JSON.parse(M);let y=x.children("td").eq(2);y.empty();let q="";for(let k=0;k<v.select.length;++k){let F=v.select[k],R=p.dataObj.codes[C].sub_items;for(let J=0;J<R.length;++J)if(F==R[J].is_seq){""!=q&&(q+="<br>"),q+=R[J].contents;break}}y.removeClass("noComment"),y.append(`<div class="review_numbers">${q}</div>`),y.append(`<div class="review_desc text-wrap">${v.text}</div>`)}catch(U){}let E=x.children("td").eq(3);if(E.hasClass("evaluation_score")){let H=`review_point_${d[C].is_seq}`;E.children("select").attr("name",H)}else{let L=`review_pass_${d[C].is_seq}`;E.children("select").attr("name",L),m=!1}A.append(x),$(".card").removeClass("hidden")}}originalJSFunction();for(let K=0;K<d.length;++K)if(m){let V=`review_point_${d[K].is_seq}`;try{let Y=u.dataObj.saved_data.data[d[K].is_seq];Y<2&&(Y=2);var g=$(`select[name=${V}]`),f=g.parent().children("div").children("a");for(let B=0;B<f.length;B++)f.eq(B).data("rating-value")==Y?(f.eq(B).addClass("br-selected br-current"),g.val(Y).prop("selected",!0)):(f.eq(B).removeClass("br-selected br-current"),g.val(Y).prop("selected",!1))}catch(G){}}else{let z=`review_pass_${d[K].is_seq}`;try{u.dataObj.saved_data.data[d[K].is_seq]>0?$(`select[name=${z}]`).parent().children("div").children("a.rating_pass[data-value=1]").click():$(`select[name=${z}]`).parent().children("div").children("a.rating_pass[data-value=0]").click()}catch(Q){}}sumPoint($("select.rating_point")),sumAccount($("select.rating_pass")),$("a.rating_pass").off()}function onClickNormalReviewFinishSubmit(){if($("#modal_finish_review").modal("hide"),!$("#check_11").is(":checked"))return alert("제출 동의를 확인해 주세요."),void $("#check_11").focus();if(IPSAP.DEMO_MODE)window.location.href="./review_list.html";else{var e=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO));g_AppItemParser.targetSavedItemNames=["normal_review_result"];var t={};t[String(e.user_seq)]=(new Date).getTime()/1e3,g_AppItemParser.addMoreSaveTag("normal_review_dttm",{data:t}),appItemSaveTemporary(onCompleteNormalReviewOpinionSubmit,IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_NORMAL)}}function onCompleteNormalReviewOpinionSubmit(e,t,a){e?window.location.href="./review_list.html":($("#modal_finish_review").modal("hide"),appSubmitHandleError("일반 심사를 완료할 수 없습니다.",t))}function setAgreeDate(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),r=t+"년 "+(a=a>=10?a:"0"+a)+"월 "+(i=i>=10?i:"0"+i)+"일";$("#normal_submit_date").text(r)}function setSubmiterName(){var e=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)).name;$("#submiter").text(e)}$((function(){loadApplicationParams(),function(e){if(IPSAP.DEMO_MODE)originalJSFunction();else{inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.SCORE?$(".evaluation_yn").remove():inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.YN?$(".evaluation_score").remove():inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.NONE?($(".evaluation_score").remove(),$(".evaluation_yn").remove(),e.find("tfoot").find(".text-right").text("")):alert("Error!!!");let t=$(".list_table").find("tbody");g_trTemplete=t.children("tr").first().clone(),t.empty();let a={"filter.query_items":"expert_review_opinion,expert_review,judge_expert_deadline,expert_member,judge_normal_deadline,normal_review_result"};g_AppItemParser=new ItemParser(g_AppInfo.appSeq),g_AppItemParser.load(a,dataMappingFunc),$('[data-target="#modal_finish_review"]').on("click",(function(){if(""==$('input:radio[name="normal_review_result_11"]:checked').siblings().closest("input").val())return alert("일반 심사 의견을 한 글자 이상 반드시 입력해주세요."),!1}))}setAgreeDate(),setSubmiterName()}($(".page-content"))}));