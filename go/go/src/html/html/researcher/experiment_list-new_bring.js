function originalJSFunction(){}function dataMappingFunc(e){var t=e.getItemData("general_title");$("#name_ko").text(t.getStringValue("name_ko")),$("#name_en").text(t.getStringValue("name_en"));{t=e.getItemData("application_info");let q=Number(t.getStringValue("approved_dttm"));$("#approved_dttm").text(getDttm(q).dt)}t=e.getItemData("general_end_date");$("#general_end_date").text(t.getStringValue("0"));var a=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO));$(".reviewer").text(spaceAddStr(a.name));{var n=e.getItemData("animal_type"),i=e.getItemData("animal_type_final"),r=e.getItemData("animal_type_bring"),l=e.getItemData("animal_sum"),d=i.dataObj.saved_data.data;0==d.length&&(d=n.dataObj.saved_data.data);var p=l.dataObj.saved_data.data;let v=r.dataObj.saved_data.data;if(v.length>0){function c(e){for(let t=0;t<d.length;++t)if(d[t].animal_code_str==e)return!0;return!1}for(let b=0;b<v.length;++b)c(v[b].animal_code_str)||d.push(v[b])}function _(e){return v.length>0?{m:v[e].male_cnt,f:v[e].female_cnt}:{m:0,f:0}}function o(e){var t=0,a=0;for(let n=0;n<v.length;++n)v[n].animal_code_str==e&&(t+=parseInt(v[n].male_cnt),a+=parseInt(v[n].female_cnt));return{m:t,f:a}}var s=$(".list_table").eq(0).children("tbody"),m=$(".list_table").eq(1).children("tbody"),f=s.children("tr").first().clone(),g=m.children("tr").first().clone();s.empty(),m.empty();let I=(new Date).toISOString().substring(0,10);for(let x=0;x<p.length;++x){let y=o(p[x].animal_code_str);(u=f.clone()).children("td").eq(0).text(p[x].animal_code_str),u.children("td").eq(1).text(p[x].male_cnt),u.children("td").eq(2).text(p[x].female_cnt),u.children("td").eq(3).text(parseInt(p[x].male_cnt)+parseInt(p[x].female_cnt)),u.children("td").eq(4).text(y.m),u.children("td").eq(5).text(y.f),u.children("td").eq(6).text(y.m+y.f),u.children("td").eq(7).text(p[x].male_cnt-y.m),u.children("td").eq(8).text(p[x].female_cnt-y.f),u.children("td").eq(9).text(parseInt(p[x].male_cnt)+parseInt(p[x].female_cnt)-y.m-y.f),s.append(u)}for(let S=0;S<d.length;++S){let P=_(S);{var u;(u=g.clone()).children("td").eq(0).text(d[S].animal_code_str);let A=d[S].male_cnt-P.m,O=d[S].female_cnt-P.f;if(A+O>0){u.children("td").eq(1).children("input").attr("max",A),u.children("td").eq(1).children("input").attr("placeholder","최대 "+A),u.children("td").eq(2).children("input").attr("max",O),u.children("td").eq(2).children("input").attr("placeholder","최대 "+O);let j=makeComboList("supplier_type_"+S,"<option selected disabled>종류 선택</option>",n.dataObj.codes,"supplier_type");u.children("td").eq(4).empty(),u.children("td").eq(4).append(j),u.children("td").eq(6).children("input").val(I),m.append(u)}}}$("input.check_change-01").on("keyup, change",(function(){let e=$(this).attr("max");if(null!=e){Number($(this).val())>Number(e)&&$(this).val(e);var t=$(this).parent().parent();let a=Number(t.children("td").eq(1).find("input").val())+Number(t.children("td").eq(2).find("input").val());t.children("td").eq(3).find("input").val(a)}}))}var h="additional_reporting";(t=e.getItemData(h)).applyTextValue();h="reporting_date";(t=e.getItemData(h)).applyCalanderValue(h),$("#reporting_date")[0].valueAsDate=new Date}function setAppChangeInfo(){urlPath=CONST.API.APPLICATION_CHANGE.ANIMALINFO,app_seq=g_AppItemParser.app_seq,API.load({url:urlPath.replace("${app_seq}",app_seq),type:CONST.API_TYPE.GET,success:function(e){if(!e)return;e.length>0&&$(".trace_label").removeClass("hidden");var t=$("#trace_changing").find(".changing-list").clone().clone();$("#trace_changing").empty();var a=1;let n=e;for(const[e,d]of Object.entries(n)){t.find(".list-num").text(a),a++,t.find(".list-date").text(d.approved_dttm);var i,r=JSON.parse(d.contents);i=t.find(".data").eq(1).children("div").first().clone(),t.find(".data").eq(1).empty(),t.find(".data").eq(2).text(r[2]),d.filepath?(t.find(".data").eq(3).text(d.org_file_name),t.find(".data").eq(3).attr("href",d.src)):t.find(".data").eq(3).text("");var l=JSON.parse(r[1]);for(let e=0;e<l.length;++e){let a=i.clone();a.find("span").eq(0).text(l[e][0]),a.find("span").eq(3).text(l[e][1]),a.find("span").eq(5).text(l[e][2]),a.find("span").eq(6).text(l[e][3]),a.find("span").eq(9).text(l[e][4]),a.find("span").eq(11).text(l[e][5]),t.find(".data").eq(1).append(a)}$("#trace_changing").append(t)}},error:function(){},complete:function(){}})}function onClickSubmit(){if(!$("#check_01").is(":checked"))return alert("제출 동의를 확인해 주세요."),void $("#check_01").focus();if(!$("#reporting_date").val())return alert("보고 일자를 선택해 주세요."),void $("#reporting_date").focus();if(IPSAP.DEMO_MODE)window.location.href="./experiment_list.html";else{var e=!1,t=[];if($(".list_table").eq(1).children("tbody").children("tr").each((function(a,n){let i={animal_code:0,lmo_flag:0,animal_code_str:$(n).children("td").eq(0).text(),male_cnt:Number($(n).children("td").eq(1).find("input").val()),female_cnt:Number($(n).children("td").eq(2).find("input").val()),supplier_type:$(n).children("td").eq(4).find("select option:selected").val(),supplier_type_str:$(n).children("td").eq(4).find("select option:selected").text(),supplier_name:$(n).children("td").eq(5).find("input").val(),genetic_type:$(n).children("td").eq(6).find("input").val(),mb_grade:0,mb_grade_str:"",breeding_place:0,breeding_place_str:"",ibc_num:"",lmo_type:0,lmo_type_str:"",strain:"",week_age:0,weight_gram:0,age_unit:0,weight_unit:0,size:0,size_unit:0};return i.male_cnt+i.female_cnt==0||(t.push(i),i.supplier_type==i.supplier_type_str?(e=!0,alert("공급처 종류를 선택해 주세요."),$(n).children("td").eq(4).find("select").focus(),!1):void 0)})),!e)if(0!=t.length){var a={parent_app_seq:g_AppItemParser.app_seq,application_type:IPSAP.APPLICATION_TYPE.BRING,judge_type:g_AppInfo.appObj.judge_type},n=new ItemParser(0);n.targetSavedItemNames=[],n.addMoreSaveTag("application_info",{data:a}),n.addMoreSaveTag("animal_type_bring",{data:t});var i={},r={};i[String(0)]=$("#additional_reporting").val(),r[String(0)]=$("#reporting_date").val(),n.addMoreSaveTag("additional_reporting",{data:i}),n.addMoreSaveTag("reporting_date",{data:r}),appItemSubmitWithParser(n,onCompleteSubmit,IPSAP.APP_SUBMIT_TYPE_PARAM.CHILD_SUBMIT)}else alert("반입신청한 내용이 없습니다.\n\n입력 내용중에 반입 수량을 확인하세요.")}}function onCompleteSubmit(e,t,a){e?window.location.href="./experiment_list.html":alert(`반입보고서 제출을 실패했습니다.\n(${t.em})`)}"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof ipsap_item_module_js&&document.write("<script src='/assets/js/ipsap/ipsap_item_module.js'><\/script>"),document.write("<script src='/html/researcher/application_new-0.js'><\/script>"),$((function(){if(g_global_mapping=!1,loadApplicationParams(),$(".task_director_all").text(`(연구 책임자 : ${g_AppInfo.appObj.user_name})`),$(".task_title_ko").text(g_AppInfo.appObj.name_ko),IPSAP.DEMO_MODE)originalJSFunction(),$(".trace_label").removeClass("hidden");else{let e={"filter.query_items":"general_title,general_end_date,application_info,animal_type,animal_type_final,animal_type_bring,additional_reporting,animal_sum,reporting_date"};g_AppItemParser=new ItemParser(g_AppInfo.appSeq),g_AppItemParser.load(e,dataMappingFunc)}setAppChangeInfo()}));