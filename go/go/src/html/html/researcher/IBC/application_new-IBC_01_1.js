"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),document.write("<script src='/html/researcher/IBC/common_application_new-IBC.js'><\/script>");var view_more_obj=$(".view_more").clone();function dataMappingFunc(e){0==e.app_seq&&e.addMoreSaveTag("application_info",{data:g_AppInfo.appObj}),getIACUCAppList(),modalGetIACUCAppList();var a="general_title";(t=e.getItemData(a)).applyTextMapValue(a+"_name_ko","name_ko"),t.applyTextMapValue(a+"_name_en","name_en");a="general_end_date";(t=e.getItemData(a)).applyCalanderValue(a);a="ibc_general_experiment_cnt";(t=e.getItemData(a)).applyTextValue();a="ibc_general_experiment_degree";(t=e.getItemData(a)).applyTextValue();a="ibc_general_fund_org";(t=e.getItemData(a)).applyMainCheckValueInCheckBox("ibc_general_fund_org-main_check")&&$("#input_01-3_group").addClass("collapse").removeClass("show");a="ibc_general_fund_org_name";(t=e.getItemData(a)).applyTextValue();a="ibc_general_fund_conflict";null!=(t=e.getItemData(a))&&t.makeHtmlRadioType();a="ibc_general_fund_start_date";(t=e.getItemData(a)).applyCalanderValue(a);a="ibc_general_fund_end_date";(t=e.getItemData(a)).applyCalanderValue(a);a="ibc_general_experiment";var t,n=(t=e.getItemData(a)).getStringValue("0"),i=[];""!=n&&(i=n.split(",")),i.length>0&&ibcResetLeftNavi(i),e.deleteSaveTag(["ibc_general_experiment"]),$(".card").removeClass("hidden")}function getIACUCAppList(){$("#list_li").empty(),API.load({url:CONST.API.APPLICATION.LIST,type:CONST.API_TYPE.GET,data:{"filter.app_view_type":12},success:function(e){if(0==e.list.length)$("#list_li").append("<li>참조할 신청서가 없습니다.</li>");else if(e.list.length<4)$.each(e.list,(function(e,a){$("#list_li").append(`<li><a href="#" data-seq="${a.application_seq}" onclick="copyIACUCApplication(${a.application_seq});">${a.name_ko}<span class="mLeft10">( ${a.application_no}, <span class="comment_date">${getDttm(a.approved_dttm).dt}</span> )</span></a></li>`)}));else{for(var a=0;a<3;a++)$("#list_li").append(`<li><a href="#" data-seq="${e.list[a].application_seq}" onclick="copyIACUCApplication(${e.list[a].application_seq});">${e.list[a].name_ko}<span class="mLeft10">( ${e.list[a].application_no}, <span class="comment_date">${getDttm(e.list[a].approved_dttm).dt}</span> )</span></a></li>`);$("#list_li").after('<button type="button" class="btn btn-primary btn_xxs mTop10 mLeft25" id="btn_IACUC_all" data-toggle="modal" data-target="#modal_allApp_list"><i class="far fa-file mRight5"></i>모든 IACUC 신청서에서 선택하기</button>')}}})}function modalGetIACUCAppList(){$(".available_app").empty(),API.load({url:CONST.API.APPLICATION.LIST,type:CONST.API_TYPE.GET,data:{"filter.app_view_type":12},success:function(e){e.list.length?$("#modal_allApp_list").find(".comment_alt").html('신청서를 선택하면, 신청서 정보가 자동으로 입력됩니다.<br><span class="comment">※ 자동 입력은 입력편의를 위한 기능이며, 참조 신청서 원본에는 영향이 없습니다.</span>'):$("#modal_allApp_list").find(".comment_alt").text("선택 가능한 신청서가 없습니다."),$.each(e.list,(function(e,a){$(".available_app").append(`<a href="#" class="list-group-item hidden" onclick="copyIACUCApplication(${a.application_seq});"><i class="far fa-file-alt text-secondary mr-2"></i>${a.name_ko}</a>`)}))},complete:function(){initVisbleApp()}})}function copyIACUCApplication(e){let a=CONST.API.APPLICATION.COPY_IACUC,t=g_AppInfo.appObj.application_seq;t||(t=0),API.load({url:a.replace("${app_seq}",t),type:CONST.API_TYPE.POST,data:{application_seq:e},success:function(e){0==t?(g_AppInfo.appSeq=e.new_info.application_seq,g_AppInfo.appObj=e.new_info,alert("접수번호가 부여되었습니다."),APP_IBC_NAVIGATION.navigate("PAGE_1_1")):(g_AppInfo.appObj=e.new_info,APP_IBC_NAVIGATION.navigate("PAGE_1_1"))}})}function setDate(){let e=new Date;e.setDate(e.getDate()+7);let a=moment(new Date).format("YYYY-MM-DD");$("#general_end_date").val(a);let t=new Date;t.setDate(t.getDate()+1095),$("#general_end_date").on("change",(function(){let n=$("#general_end_date").val().split("-"),i=new Date(n[0],parseInt(n[1]-1),n[2]);e.getTime()>i.getTime()?(alert("오늘로부터 일주일 이후 날짜부터 선택이 가능합니다."),$("#general_end_date").val(a)):t.getTime()<i.getTime()&&(alert("연구 기간은 신청일 기준 3년까지 가능합니다."),$("#general_end_date").val(a))}))}function initVisbleApp(){$("[data-val-name=init_visible_count]").text(CONST.VISIBLE_AVAILABLE_ITEMS),$(".available_app").each((function(e,a){var t=$(a).find("a");for(let e=0;e<CONST.VISIBLE_AVAILABLE_ITEMS;e++)t.eq(e).removeClass("hidden");t.length>CONST.VISIBLE_AVAILABLE_ITEMS&&$(a).append(view_more_obj.clone(!0))}))}function viewHiddenApp(e){$(e).siblings(".hidden").removeClass("hidden"),$(e).add($(e).closest(".modal-body").find(".more_comment")).remove()}$(document).ready((function(){loadApplicationParams(),g_AppItemParser=new ItemParser(g_AppInfo.appSeq),g_AppItemParser.load({"filter.query_items":"general_title, ibc_general_date_cnt,ibc_general_fund_org,ibc_general_experiment"},dataMappingFunc);var e=function(e,a){this.phase="page1_1",this.btn_type=a};e.prototype.check=function(){"nextPage"==this.btn_type?appNaviNextPage():saveTemporary()},di.autowired(!1).register("validator_nextPage").as(e).withConstructor().withProperties().prop("btn_type").val("nextPage").register("validator_tempSave").as(e).withConstructor().withProperties().prop("btn_type").val("tempSave")}));