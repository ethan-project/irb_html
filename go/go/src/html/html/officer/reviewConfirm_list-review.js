var g_trTemplete;"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof ipsap_item_module_js&&document.write("<script src='/assets/js/ipsap/ipsap_item_module.js'><\/script>"),document.write("<script src='../researcher/application_new-0.js'><\/script>");var user_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)),inst_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_INST_INFO));function originalJSFunction(e){$(".rating_point").each((function(e,t){let a=$(t).val()?$(t).val():null;ratingEnable($(t),a,!0)})),sumPoint($("select.rating_point")),sumAccount($("select.rating_pass")),$("select.rating_point").on({change:function(e){sumPoint($("select.rating_point"))}}),$("select.rating_pass").on({change:function(e){sumAccount($("select.rating_pass"))}}),$("a.rating_pass").on({click:function(e){$(this).siblings().removeClass("active"),$(this).addClass("active"),$(this).parent().siblings("select").val($(this).data("value")).trigger("change")}})}function sumPoint(e){var t=0,a="fail";e.each((function(e,a){if(!$(a).val())return 0;t+=parseInt($(a).val())})),a=t>=parseInt(inst_info.ia_base_score)?"pass":a,$("#total_sum").html(`<span class="${a}">${t}</span> / 100`)}function sumAccount(e){var t=0,a="fail";e.each((function(e,a){if(!$(a).val())return 0;t+=parseInt($(a).val())})),a=t>=parseInt(inst_info.ia_base_item)?"pass":a,$("#total_account").html(`<span class="${a}">${t}</span> / 10`)}function dataMappingFunc(e){(t=e.getItemData("final_judge_result")).makeHtmlRadioType(IPSAP.COL.ALL,0);var t=e.getItemData("general_title",!0);$("#coding_title_area").children("div").eq(0).children("span").text(t.getStringValue("name_ko")),$("#coding_title_area").children("div").eq(1).children("span").text(t.getStringValue("name_en"));t=e.getItemData("general_end_date",!0);"0"==g_AppInfo.appObj.approved_dttm?$("#coding_title_area").children("div").eq(2).children("span").text("위원회 승인일 ~ "+t.getStringValue("0")):$("#coding_title_area").children("div").eq(2).children("span").text(getDttm(g_AppInfo.appObj.approved_dttm).dt+" ~ "+t.getStringValue("0")),(t=e.getItemData("expert_review_total_review")).applyTextValueReadOnly();{t=e.getItemData("expert_review_result");let A=0;try{A=Number(t.dataObj.saved_data.data[0].select_ids[0])}catch(P){}let O="";try{O=t.dataObj.saved_data.data[0].inputs[String(A)][1]}catch(x){}let q="";for(let w=0;w<t.dataObj.items.length;++w)if(t.dataObj.items[w].id==A){q=t.dataObj.items[w].value;break}$("#expert_review_result").text(q),""!=O?$("#expert_review_result_text").text(O):$("#expert_review_result_text").remove()}{t=e.getItemData("expert_member");var a="";try{a=t.dataObj.saved_data.data[0].info.name}catch(C){}$("#experter").text(spaceAddStr(a));var i=0;try{i=t.dataObj.saved_data.data[0].user_seq}catch(E){}var n=e.getItemData("expert_review_dttm");const j=new Date(1e3*n.dataObj.saved_data.data[String(i)]);$("#expert_submit_date").text(getTimeStrFromDateType(j))}let r,s=!0;{var l=e.getItemData("expert_review_opinion",!0),d=e.getItemData("expert_review_evaluation",!0);let y=$(".list_table").first().find("tbody");r=d.dataObj.codes;for(let D=0;D<r.length;++D){let T=g_trTemplete.clone();T.children("td").eq(0).text(r[D].contents);let M=T.children("td").eq(1),k=M.children("ul").children("li").first().clone();M.children("ul").empty();for(let F=0;F<r[D].sub_items.length;++F){let R=k.clone();R.text(r[D].sub_items[F].contents),M.children("ul").append(R)}try{let U=l.dataObj.saved_data.data[r[D].is_seq];var o=JSON.parse(U);let J=T.children("td").eq(2);J.empty();let L="";for(let V=0;V<o.select.length;++V){let Y=o.select[V],H=l.dataObj.codes[D].sub_items;for(let B=0;B<H.length;++B)if(Y==H[B].is_seq){""!=L&&(L+="<br>"),L+=H[B].contents;break}}J.removeClass("noComment"),J.append(`<div class="review_numbers">${L}</div>`),J.append(`<div class="review_desc text-wrap">${o.text}</div>`)}catch(G){}let N=T.children("td").eq(3);if(N.hasClass("evaluation_score")){let K=`review_point_${r[D].is_seq}`;N.children("select").attr("name",K)}else{let Q=`review_pass_${r[D].is_seq}`;N.children("select").attr("name",Q),s=!1}y.append(T)}}{var c=$(".list_table").eq(1).children("tbody").children("tr").first().clone();$(".list_table").eq(1).children("tbody").empty();var _=e.getItemData("normal_review_result",!0),m=e.getItemData("committee_in_member",!0),p=e.getItemData("committee_ex_member",!0),u=e.getItemData("normal_review_dttm",!0);let z=1;const W=m.dataObj.saved_data.data,X=p.dataObj.saved_data.data;var h,v,g=[0,0,0];if(null!=W)for(let Z=0;Z<W.length;++Z){h=void 0;try{h=_.dataObj.saved_data.data[String(W[Z].info.user_seq)]}catch(ee){}v=void 0;try{v=u.dataObj.saved_data.data[String(W[Z].info.user_seq)]}catch(te){}g[b(z++,W[Z],"내부",h,v)]++}if(null!=X)for(let ae=0;ae<X.length;++ae){h=void 0;try{h=_.dataObj.saved_data.data[String(X[ae].info.user_seq)]}catch(ie){}v=void 0;try{v=u.dataObj.saved_data.data[String(X[ae].info.user_seq)]}catch(ne){}g[b(z++,X[ae],"외부",h,v)]++}var f=$(".list_table").eq(1).children("tfoot");function b(e,t,a,i,n){var r=0,s=c.clone();s.removeClass("agree");let l=0;if(s.attr("user_seq",t.user_seq),s.children("td").eq(l++).text(e),s.children("td").eq(l++).text(t.info.name),s.children("td").eq(l++).text(a),null!=i&&n>0)if(s.children("td").eq(l++).text(getYMDHMSFromUnixtime(n,!0)),"1"==i.select_ids[0]){let e=i.inputs[1][1];s.addClass("agree"),s.children("td").eq(l++).text("찬성"),s.children("td").eq(l++).html(`\n          <a href="javascript:void(0);" onclick="onClickShowAgreeReason('${e}');" class="blue_deep">\n            <i class="fas fa-comment-dots mRight5"></i>${stringShortDot(e,15)}\n          </a>`)}else{r=1,s.addClass("disagree");let e=i.inputs[2][1];s.children("td").eq(l++).text("반대"),s.children("td").eq(l++).html(`\n            <a href="javascript:void(0);" onclick="onClickShowOpposeReason('${e}');" class="red">\n              <i class="fas fa-comment-dots mRight5"></i>${stringShortDot(e,15)}\n            </a>`)}else r=2,s.addClass("timeout"),s.children("td").eq(l++).text("-"),s.children("td").eq(l++).text("-"),s.children("td").eq(l++).text("미이행");return $(".list_table").eq(1).children("tbody").append(s),r}f.children("tr").children("td").eq(1).children("span").eq(0).children("span").text(g[0]),f.children("tr").children("td").eq(1).children("span").eq(1).children("span").text(g[1]),f.children("tr").children("td").eq(1).children("span").eq(2).children("span").text(g[2])}originalJSFunction();for(let re=0;re<r.length;++re)if(s){let se=`review_point_${r[re].is_seq}`;try{let le=d.dataObj.saved_data.data[r[re].is_seq];le<2&&(le=2);var I=$(`select[name=${se}]`),S=I.parent().children("div").children("a");for(let de=0;de<S.length;de++)S.eq(de).data("rating-value")==le?(S.eq(de).addClass("br-selected br-current"),I.val(le).prop("selected",!0)):(S.eq(de).removeClass("br-selected br-current"),I.val(le).prop("selected",!1))}catch(oe){}}else{let ce=`review_pass_${r[re].is_seq}`;try{d.dataObj.saved_data.data[r[re].is_seq]>0?$(`select[name=${ce}]`).parent().children("div").children("a.rating_pass[data-value=1]").click():$(`select[name=${ce}]`).parent().children("div").children("a.rating_pass[data-value=0]").click()}catch(_e){}}sumPoint($("select.rating_point")),sumAccount($("select.rating_pass")),$("a.rating_pass").off(),$(".card").removeClass("hidden")}function onClickShowOpposeReason(e){$(".oppose_reason").text(e),$("#modal_disagree_comment").modal("show")}function onClickShowAgreeReason(e){$(".agree_reason").text(e),$("#modal_agree_comment").modal("show")}function onClickFinalFinishSubmit(){if($("#modal_confirm_review").modal("hide"),IPSAP.DEMO_MODE)window.location.href="./reviewConfirm_list.html";else{g_AppItemParser.targetSavedItemNames=["final_judge_result"];var e=IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_FINAL_REJECT;switch(Number($('input:radio[name="final_judge_result_0"]:checked').val())){case 1:e=IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_FINAL_A;break;case 2:e=IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_FINAL_AC;break;case 3:e=IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_FINAL_REQUIRE_RETRY}appItemSubmit(onCompleteFinalFinishSubmit,e)}}function onCompleteFinalFinishSubmit(e,t,a){e?window.location.href="./reviewConfirm_list.html":appSubmitHandleError("심의 완료를 실패했습니다.",t)}$((function(){loadApplicationParams(),function(e){if(IPSAP.DEMO_MODE)originalJSFunction();else{inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.SCORE?$(".evaluation_yn").remove():inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.YN?$(".evaluation_score").remove():inst_info.ia_evaluation_method==IPSAP.EVALUATION_METHOD.NONE?($(".evaluation_score").remove(),$(".evaluation_yn").remove(),e.find("tfoot").find(".text-right").text("")):alert("Error!!!");let t=$(".list_table").first().find("tbody");g_trTemplete=t.children("tr").first().clone(),t.empty();let a={"filter.query_items":"general_title,general_end_date,final_judge_result,expert_review_opinion,expert_review,expert_member,committee_in_member,committee_ex_member,normal_review_result,normal_review_dttm"};g_AppItemParser=new ItemParser(g_AppInfo.appSeq),g_AppItemParser.load(a,dataMappingFunc)}$('[data-target="#modal_confirm_review"]').on("click",(function(){if(""==$('input:radio[name="final_judge_result_0"]:checked').siblings().closest("input").val())return alert("최종 심의 결과를 입력해 주시기 바랍니다."),!1}))}($(".page-content"))}));