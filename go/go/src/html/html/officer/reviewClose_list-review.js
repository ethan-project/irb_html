var g_trTemplete;"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof ipsap_item_module_js&&document.write("<script src='/assets/js/ipsap/ipsap_item_module.js'><\/script>"),document.write("<script src='../researcher/application_new-0.js'><\/script>"),"undefined"==typeof date_utils_js&&document.write("<script src='/assets/js/common/util/date_utils.js'><\/script>"),$((function(){loadApplicationParams();$(".page-contents");!function(e){if(IPSAP.DEMO_MODE)originalJSFunction();else{$("#btn_finish").addClass("disabled"),getCommittee();let e={"filter.query_items":"general_title,general_end_date,judge_expert_deadline,judge_normal_deadline,committee_in_member,committee_ex_member,normal_review_result,normal_review_dttm"};g_AppItemParser=new ItemParser(g_AppInfo.appSeq),g_AppItemParser.load(e,dataMappingFunc)}}()}));var g_normal_deadline_timestamp=(new Date).getTime(),committeeList;function originalJSFunction(e){function t(){if(!isObjVisible($("#date_3").parent()))return void $("#btn_continue").addClass("disabled");var e=Number($("#date_3").val());if(0==e)return void $(".changed_deadline").hide();if($(".changed_deadline").show(),e*=0==$("#select_dayhour option").index($("#select_dayhour option:selected"))?864e5:36e5,0!=$("#select_pullpush option").index($("#select_pullpush option:selected"))&&(e*=-1),e+=g_normal_deadline_timestamp,$(".changed_deadline").removeClass("red"),e<(new Date).getTime())return $(".changed_deadline").text("현재시간 이전으로는 변경할 수 없습니다."),$(".changed_deadline").addClass("red"),void $("#btn_continue").addClass("disabled");const t=new Date(e);$(".changed_deadline").text(getYMDHMSFromDateType(t)),$("#btn_continue").removeClass("disabled")}$("#change_deadline_btn").on("click",(function(){t()})),$("#date_3").on("keyup change",(function(){t()})),$("#select_dayhour").on("change",(function(){t()})),$("#select_pullpush").on("change",(function(){t()})),t()}function getCommittee(){$(".list_table").eq(1).children("tbody").empty();var inst_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_INST_INFO));let inst_seq=inst_info.institution_seq;API.load({url:eval("`"+CONST.API.INSTITUTION.USER+"`"),type:CONST.API_TYPE.GET,data:{"filter.user_type":4},success:function(e){$.each(committeeList,(function(e,t){t.tmp_phoneno=t.phoneno.replace(/(^02.{0}|^01.{1}|[0-9]{3})([0-9]+)([0-9]{4})/,"$1-$2-$3"),t.tmp_edu_date=t.edu_date.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")})),committeeList=e},complete:function(){},error:function(e){}})}function remakeCommitteeList(){null!=committeeList&&($(".list_table").eq(1).children("tbody").empty(),$.each(committeeList,(function(e,t){if(!function(e){let t=!1;return $.each($(".list_table").first().children("tbody").children("tr"),(function(n,i){if(e==Number($(this).attr("user_seq")))return t=!0,!1})),t}(t.user_seq)){let e=`\n        <tr data-user_seq="${t.user_seq}">\n          <td>${t.name}</td>\n          <td>${t.dept_str}</td>\n          <td>${t.position_str}</td>\n          <td>${t.major_field_str}</td>\n          <td>${t.tmp_phoneno}</td>\n          <td>${t.email}</td>\n          <td>${t.tmp_edu_date}</td>\n          <td>${t.edu_institution_str}</td>\n          <td>${t.edu_course_num}</td>\n          <td>\n            <select class="form-control btn-outline-primary small_select committee_select">\n              <option value="0" selected>선택</option>\n              <option value="내부">내부</option>\n              <option value="외부">외부</option>\n            </select>\n          </td>\n        </tr>`;$(".list_table").eq(1).children("tbody").append(e)}})),$(".committee_select").off(),$(".committee_select").on("change",(function(){onClickNewCommittee(Number($(this).parent().parent().data("user_seq")),$(this).val())})))}function dataMappingFunc(e){var t=e.getItemData("general_title",!0);$("#coding_title_area").children("div").eq(0).children("span").text(t.getStringValue("name_ko")),$("#coding_title_area").children("div").eq(1).children("span").text(t.getStringValue("name_en"));t=e.getItemData("general_end_date",!0);"0"==g_AppInfo.appObj.approved_dttm?$("#coding_title_area").children("div").eq(2).children("span").text("위원회 승인일 ~ "+t.getStringValue("0")):$("#coding_title_area").children("div").eq(2).children("span").text(getDttm(g_AppInfo.appObj.approved_dttm).dt+" ~ "+t.getStringValue("0"));var n,i=(new Date).getTime();{var a=e.getItemData("judge_expert_deadline",!0).getStringValue("0");if(""==a)return void alert("전문 심사 종료일 Error!!!");n=new Date(a).getTime();const b=new Date(n);$(".expert_deadline").text(getYMDHMSFromDateType(b)),i>=n?$(".expert_deadline").addClass("red"):$(".expert_deadline").removeClass("red")}{var r=e.getItemData("judge_normal_deadline",!0).getStringValue("0");if(""==r)return void alert("일반 심사 종료일 Error!!!");var d=r,s="H";if(r.length>1){d=r.substring(0,r.length-1);s=r.slice(-1)}0==d&&(d=7),g_normal_deadline_timestamp=n,"H"==s?(g_normal_deadline_timestamp+=3600*d*1e3,$("#select_dayhour option:eq(1)").attr("selected","selected")):g_normal_deadline_timestamp+=86400*d*1e3;const q=new Date(g_normal_deadline_timestamp);$(".normal_deadline").text(getYMDHMSFromDateType(q)),i>=g_normal_deadline_timestamp?$(".normal_deadline").addClass("red"):$(".normal_deadline").removeClass("red")}{function l(){var e=(new Date).getTime(),t=parseInt((g_normal_deadline_timestamp-e)/1e3);let n=getTimeStrFromSec(t);$(".timer").text(n),t>=0?$(".timer").parent().removeClass("timeout"):$(".timer").parent().addClass("timeout")}l(),setInterval((function(){l()}),1e3)}{var o=$(".list_table").first().children("tbody").children("tr").first().clone();$(".list_table").first().children("tbody").empty();var c=e.getItemData("normal_review_result",!0),m=e.getItemData("committee_in_member",!0),_=e.getItemData("committee_ex_member",!0),p=e.getItemData("normal_review_dttm",!0);let S=1;const C=m.dataObj.saved_data.data,w=_.dataObj.saved_data.data;var u,h,g=[0,0,0];if(null!=C)for(let I=0;I<C.length;++I){u=void 0;try{u=c.dataObj.saved_data.data[String(C[I].info.user_seq)]}catch(x){}h=void 0;try{h=p.dataObj.saved_data.data[String(C[I].info.user_seq)]}catch(y){}g[v(S++,C[I],"내부",u,h)]++}if(null!=w)for(let D=0;D<w.length;++D){u=void 0;try{u=c.dataObj.saved_data.data[String(w[D].info.user_seq)]}catch(P){}h=void 0;try{h=p.dataObj.saved_data.data[String(w[D].info.user_seq)]}catch(j){}g[v(S++,w[D],"외부",u,h)]++}var f=$(".list_table").first().children("tfoot");function v(e,t,n,i,a){var r=0,d=o.clone();d.removeClass("agree");let s=0;if(d.attr("user_seq",t.user_seq),d.children("td").eq(s++).text(e),d.children("td").eq(s++).text(t.info.name),d.children("td").eq(s++).text(n),null!=i&&a>0)if(d.children("td").eq(s++).text(getYMDHMSFromUnixtime(a,!0)),"1"==i.select_ids[0]){let e=i.inputs[1][1];d.addClass("agree"),d.children("td").eq(s++).text("찬성"),d.children("td").eq(s++).html(`\n          <a href="javascript:void(0);" onclick="onClickShowAgreeReason('${e}');" class="blue_deep">\n            <i class="fas fa-comment-dots mRight5"></i>${stringShortDot(e,15)}\n          </a>`)}else{r=1,d.addClass("disagree");let e=i.inputs[2][1];d.children("td").eq(s++).text("반대"),d.children("td").eq(s++).html(`\n            <a href="javascript:void(0);" onclick="onClickShowOpposeReason('${e}');" class="red">\n              <i class="fas fa-comment-dots mRight5"></i>${stringShortDot(e,15)}\n            </a>`)}else r=2,d.addClass("timeout"),d.children("td").eq(s++).text("-"),d.children("td").eq(s++).text("-"),d.children("td").eq(s++).html(`\n          <button type="button" class="btn btn-danger btn-xs mLeft10" onclick="onClickChangeCommittee('${t.user_seq}');">\n            <i class="fas fa-file-alt mRight5"></i>심사 위원 변경\n          </button>\n          <button type="button" class="btn btn-outline-danger btn-xs mLeft5" onclick="onClickRemoveCommittee('${t.user_seq}');">\n            <i class="fas fa-times mRight5"></i>제외\n          </button>`);return $(".list_table").first().children("tbody").append(d),r}f.children("tr").children("td").eq(1).children("span").eq(0).children("span").text(g[0]),f.children("tr").children("td").eq(1).children("span").eq(1).children("span").text(g[1]),f.children("tr").children("td").eq(1).children("span").eq(2).children("span").text(g[2])}originalJSFunction()}var old_user_seq=0;function onClickNewCommittee(e,t){let n;$("#modal_change_reviewer").modal("hide"),$.each(committeeList,(function(t,i){if(i.user_seq==e)return n=i,!1})),null!=n&&$.each($(".list_table").first().children("tbody").children("tr"),(function(e,i){if(old_user_seq==Number($(this).attr("user_seq"))){$(this).attr("user_seq",n.user_seq);let e=0;return e++,$(this).children("td").eq(e++).text(n.name),$(this).children("td").eq(e++).text(t),!1}}))}function onClickRemoveCommittee(e){old_user_seq=e,$("#modal_remove_reviewer").modal("show")}function onClickRemoveMember(){$("#modal_remove_reviewer").modal("hide");var e=1,t=$(".list_table").first().children("tbody").children("tr");$.each(t,(function(t,n){if($(this).attr("user_seq")==old_user_seq){$(this).remove();var i=$(".list_table").first().children("tfoot");let e=i.children("tr").children("td").eq(1).children("span").eq(2).children("span").text(),t=Number(e)-1;i.children("tr").children("td").eq(1).children("span").eq(2).children("span").text(t),0==t&&$("#btn_finish").removeClass("disabled")}else $(this).children("td").eq(0).text(String(e++))}))}function onClickChangeCommittee(e){old_user_seq=e,remakeCommitteeList(),$("#modal_change_reviewer").modal("show")}function onClickShowAgreeReason(e){$(".agree_reason").text(e),$("#modal_agree_comment").modal("show")}function onClickShowOpposeReason(e){$(".oppose_reason").text(e),$("#modal_disagree_comment").modal("show")}function onClickResume(){if($("#modal_resume_review").modal("hide"),IPSAP.DEMO_MODE)window.location.href="./application_list.html";else{if(isObjVisible($("#date_3").parent())){var e=g_AppItemParser.getItemData("judge_normal_deadline",!0).getStringValue("0");""==e&&(e="3D");var t=e,n="H";e.length>1&&(t=e.substring(0,e.length-1),n=e.slice(-1)),0==t&&(t=7);var i=Number($("#date_3").val());0!=$("#select_pullpush option").index($("#select_pullpush option:selected"))&&(i*=-1);var a=(t=Number(t)+Number(i))+n;g_AppItemParser.addMoreSaveTag("judge_normal_deadline",{data:{0:a}})}var r=[],d=[],s=$(".list_table").first().children("tbody").children("tr");$.each(s,(function(e,t){let n=$(this).attr("user_seq");"내부"==$(this).children("td").eq(2).text()?r.push({user_seq:n}):d.push({user_seq:n})})),g_AppItemParser.addMoreSaveTag("committee_in_member",{data:r}),g_AppItemParser.addMoreSaveTag("committee_ex_member",{data:d}),g_AppItemParser.targetSavedItemNames=[],appItemSubmit(onCompleteResume,IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_RESUME)}}function onCompleteResume(e,t,n){e?window.location.href="./reviewClose_list.html":($("#modal_finish_review").modal("hide"),appSubmitHandleError("일반 심사를 재개할 수 없습니다.",t))}function onClickFinish(){if($("#modal_close_review").modal("hide"),IPSAP.DEMO_MODE)window.location.href="./application_list.html";else{var e=[],t=[],n=$(".list_table").first().children("tbody").children("tr");$.each(n,(function(n,i){let a=$(this).attr("user_seq");"내부"==$(this).children("td").eq(2).text()?e.push({user_seq:a}):t.push({user_seq:a})})),g_AppItemParser.addMoreSaveTag("committee_in_member",{data:e}),g_AppItemParser.addMoreSaveTag("committee_ex_member",{data:t}),g_AppItemParser.targetSavedItemNames=[],appItemSubmit(onCompleteFinish,IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_FINISH)}}function onCompleteFinish(e,t,n){e?window.location.href="./reviewConfirm_list.html":($("#modal_close_review").modal("hide"),appSubmitHandleError("심사를 종료할 수 없습니다.",t))}