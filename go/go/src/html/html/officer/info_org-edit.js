"undefined"==typeof ipsap_common_js&&document.write("<script src='/assets/js/ipsap/ipsap_common.js'><\/script>"),"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof date_utils_js&&document.write("<script src='/assets/js/common/util/date_utils.js'><\/script>"),"undefined"==typeof ipsap_application_common_js&&document.write("<script src='/assets/js/ipsap/ipsap_application_common.js'><\/script>");var user_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)),inst_seq=user_info.institution_seq,institution_seq=inst_seq;function getInfo(){API.load({url:eval("`"+CONST.API.INSTITUTION.DETAIL+"`"),type:CONST.API_TYPE.GET,success:function(e){if(e.institution_type.length>0){$(`input:radio[name="org_type"][value="${e.institution_type}"]`).prop("checked","checked")}if($("#org_name_kr").val(e.name_ko),$("#org_name_en").val(e.name_en),$("#org_code").val(e.institution_code),$("#org_zipcode").val(e.zipcode),$("#addr_str_1").text(e.addr1),$("#addr_str_2").val(e.addr2),$("#org_url").val(e.homepage_url),$('label[for="org_logo_file"]').text(e.logo_file_org_name),e.judge_type.length>0){let t=[];t.push(e.judge_type.split(",")),$.each(t[0],(function(e,t){$(`input:checkbox[name="evaluation_type"][value="${t}"]`).attr("checked",!0)}))}if(1==e.ia_evaluation_method?($("#org_rule_1_1").prop("checked","checked"),$("#IACUC_agree_point").val(e.ia_base_score)):2==e.ia_evaluation_method?($("#org_rule_1_2").prop("checked","checked"),$("#IACUC_agree_count").val(e.ia_base_item)):$("#org_rule_1_3").prop("checked","checked"),1==e.ia_final_director?$("#org_rule_2_1").prop("checked","checked"):$("#org_rule_2_2").prop("checked","checked"),$('label[for="org_cert"]').siblings().text(e.business_num),$("#org_registration_num_pop").val(e.business_num),$('label[for="org_cert_file"]').siblings().find("a").text(e.business_file_org_name),$('label[for="org_cert_file"]').siblings().find("a").text().length>0&&$('label[for="org_cert_file"]').siblings().find("a").attr("href",e.business_file_src),e.payment_method.length>0){let t=e.payment_method.split(",");$.each(t,(function(e,t){let i=$(`input:checkbox[name="payment_type"][value="${t}"]`),o=$(`input:checkbox[name="payment_type_pop"][value="${t}"]`);i.attr("checked",!0),o.attr("checked",!0),i.attr("readonly",!0)})),$('input:checkbox[name="payment_type"]').not(":checked").attr("disabled",!0)}e.invoice_flag.length>0&&($('input:radio[name="org_invoice"]').each((function(){$(this).val()!=e.invoice_flag?$(this).prop("disabled",!0):($(this).prop("checked",!0),$(this).prop("readonly",!0))})),$('input:radio[name="org_invoice_pop"]').each((function(){$(this).val()==e.invoice_flag&&($(this).prop("checked",!0),$(this).prop("readonly",!0))})))}})}function logoValidCheck(){var e=$("#org_logo_file")[0].files[0];if(""!=$("#org_logo_file").val()){let t=e.name.split(".").pop().toLowerCase();if(-1==$.inArray(t,["jpg","png","jpeg","ico","tiff","svg"]))return $("#modal_file_alert").modal("show"),void $("#org_logo_file").val("");if(e.size>20971520)return $("#modal_file_alert").modal("show"),void $("#org_logo_file").val("")}setInfo()}function bizVaildCheck(){var e=$("#org_registration_file_pop")[0].files[0];if(""!=$("#org_registration_file_pop").val()){let t=e.name.split(".").pop().toLowerCase();if(-1==$.inArray(t,["jpg","png","jpeg","ico","tiff","svg","pdf"]))return $("#modal_file_alert").modal("show"),void $("#org_registration_file_pop").val("");if(e.size>20971520)return $("#modal_file_alert").modal("show"),void $("#org_registration_file_pop").val("")}payMethodModify()}function setInfo(){var contents=$(".page-content"),logo_file=$("#org_logo_file")[0].files[0],judge_type_arr=[];$('input:checkbox[name="evaluation_type"]').each((function(){this.checked&&judge_type_arr.push(this.value)}));var institutionObj=new Object;institutionObj.addr1=$("#addr_str_1").text(),institutionObj.addr2=$("#addr_str_2").val(),institutionObj.homepage_url=$("#org_url").val(),institutionObj.ia_base_item=parseInt($("#IACUC_agree_count").val()),institutionObj.ia_base_score=parseInt($("#IACUC_agree_point").val()),institutionObj.ia_evaluation_method=parseInt($("input:radio[name=org_rule_1]:checked").val()),institutionObj.ia_final_director=parseInt($("input:radio[name=org_rule_2]:checked").val()),institutionObj.institution_code=$("#org_code").val(),institutionObj.institution_type=parseInt($("input:radio[name=org_type]:checked").val()),institutionObj.judge_type=judge_type_arr.toString(),institutionObj.name_en=$("#org_name_en").val(),institutionObj.name_ko=$("#org_name_kr").val(),institutionObj.zipcode=$("#org_zipcode").val();var param=JSON.stringify(institutionObj),formData=new FormData;formData.append("logo_file",logo_file),formData.append("param",param),API.load({url:eval("`"+CONST.API.INSTITUTION.PATCH+"`"),type:CONST.API_TYPE.PATCH,enctype:"multipart/form-data",data:formData,contentType:!1,processData:!1,success:function(e){COMM.setCookie("logo_file_src",e.logo_file_src),$("#modal_saved").modal("show")},error:function(e){}})}function payMethodModify(){var business_file=$("#org_registration_file_pop")[0].files[0],payment_method_arr=[];$('input:checkbox[name="payment_type_pop"]').each((function(){this.checked&&payment_method_arr.push(this.value)}));var payMethodObj=new Object;payMethodObj.business_num=$("#org_registration_num_pop").val().replaceAll("-",""),payMethodObj.payment_method=payment_method_arr.toString(),payMethodObj.invoice_falg=parseInt($("input:radio[name=org_invoice_pop]:checked").val());var param=JSON.stringify(payMethodObj),formData=new FormData;formData.append("business_file",business_file),formData.append("param",param),API.load({url:eval("`"+CONST.API.INSTITUTION.PATCH_PAYMENT+"`"),type:CONST.API_TYPE.POST,enctype:"multipart/form-data",data:formData,contentType:!1,processData:!1,success:function(e){},complete:function(){$("#modal_submitted").modal("show")},error:function(e){}})}function InstitutionIPSAPWithdraw(){let e=CONST.API.INSTITUTION.WITHDRAW;API.load({url:e.replace("${inst_seq}",institution_seq),type:CONST.API_TYPE.DELETE,success:function(e){$("#modal_request_submitted").modal("show")},error:function(e){return alert("예상치 못한 이유로 기관 탈퇴 신청을 실패했습니다. 관리자에게 문의 바랍니다."),!1}})}$((function(){IPSAP.DEMO_MODE||(getInfo(),$("#btn_set_info").on("click",(function(e){e.stopPropagation(),logoValidCheck()})),$("#btn_pay_method_modify").on("click",(function(e){if(e.stopPropagation(),0==$('input:checkbox[name="payment_type_pop"]:checked').length)return alert("서비스 이용료 결제방식을 하나 이상 체크해 주세요."),!1;bizVaildCheck()})),$("#btn_request_submit").on("click",(function(){InstitutionIPSAPWithdraw()})))}));