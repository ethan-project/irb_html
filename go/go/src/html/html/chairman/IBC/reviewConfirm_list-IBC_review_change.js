var g_trTemplete,changeInfoTemplate,changeMemberTemplate,changeEndDateTemplate;"undefined"==typeof api_js&&document.write("<script src='/assets/js/common/api.js'><\/script>"),"undefined"==typeof const_js&&document.write("<script src='/assets/js/common/const.js'><\/script>"),"undefined"==typeof ipsap_item_module_js&&document.write("<script src='/assets/js/ipsap/ipsap_item_module.js'><\/script>"),document.write("<script src='/html/researcher/IBC/common_application_new-IBC.js'><\/script>");const member_is_seq=286,end_date_is_seq=288;var user_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)),inst_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_INST_INFO));function dataMappingFunc(e){var t=!1,a=e.getParentItemData("general_title");$("#name_ko").text(a.getStringValue("name_ko")),$("#name_en").text(a.getStringValue("name_en"));{a=e.getParentItemData("application_info");let L=Number(a.getStringValue("approved_dttm"));$("#approved_dttm").text(getDttm(L).dt)}a=e.getParentItemData("general_end_date");$("#general_end_date").text(a.getStringValue("0"));var n=(a=e.getParentItemData("ibc_general_experiment")).getStringValue("0"),d=[];if(""!=n&&(d=n.split(",")),Math.min.apply(null,d)<=8?$("#fast_hide_area").removeClass("hidden"):t=!0,!t){try{var a=e.getItemData("expert_review_result");let Y=Number(a.dataObj.saved_data.data[0].select_ids[0]),G="";try{G=a.dataObj.saved_data.data[0].inputs[String(Y)][1]}catch(K){}let H="";for(let Q=0;Q<a.dataObj.items.length;++Q)if(a.dataObj.items[Q].id==Y){H=a.dataObj.items[Q].value;break}$("#expert_review_result").text(H),""!=G?$("#expert_review_result_text").text(G):$("#expert_review_result_text").remove()}catch(W){}(a=e.getItemData("expert_review_total_review")).applyTextValueReadOnly();{var i=(a=e.getItemData("expert_member")).dataObj.saved_data.data[0].info.name;$(".reviewer").eq(1).text(spaceAddStr(i));var r=a.dataObj.saved_data.data[0].user_seq,l=e.getItemData("expert_review_dttm");const z=new Date(1e3*l.dataObj.saved_data.data[String(r)]);$(".agree_date").eq(1).text(getTimeStrFromDateType(z))}{var s=$(".list_table").eq(0).children("tbody").children("tr").first().clone();$(".list_table").eq(0).children("tbody").empty();var c=e.getItemData("normal_review_result",!0),_=e.getItemData("committee_in_member",!0),o=e.getItemData("committee_ex_member",!0),p=e.getItemData("normal_review_dttm",!0);let X=1;const Z=_.dataObj.saved_data.data,ee=o.dataObj.saved_data.data;var m,g,h=[0,0,0];if(null!=Z)for(let te=0;te<Z.length;++te){m=void 0;try{m=c.dataObj.saved_data.data[String(Z[te].info.user_seq)]}catch(ae){}g=void 0;try{g=p.dataObj.saved_data.data[String(Z[te].info.user_seq)]}catch(ne){}h[u(X++,Z[te],"내부",m,g)]++}if(null!=ee)for(let de=0;de<ee.length;++de){m=void 0;try{m=c.dataObj.saved_data.data[String(ee[de].info.user_seq)]}catch(ie){}g=void 0;try{g=p.dataObj.saved_data.data[String(ee[de].info.user_seq)]}catch(re){}h[u(X++,ee[de],"외부",m,g)]++}var f=$(".list_table").eq(0).children("tfoot");function u(e,t,a,n,d){var i=0,r=s.clone();r.removeClass("agree");let l=0;if(r.attr("user_seq",t.user_seq),r.children("td").eq(l++).text(e),r.children("td").eq(l++).text(t.info.name),r.children("td").eq(l++).text(a),null!=n&&d>0)if(r.children("td").eq(l++).text(getYMDHMSFromUnixtime(d,!0)),"1"==n.select_ids[0]){let e=n.inputs[1][1];r.addClass("agree"),r.children("td").eq(l++).text("찬성"),r.children("td").eq(l++).html(`\n            <a href="javascript:void(0);" onclick="onClickShowAgreeReason('${e}');" class="blue_deep">\n              <i class="fas fa-comment-dots mRight5"></i>${stringShortDot(e,15)}\n            </a>`)}else{i=1,r.addClass("disagree");let e=n.inputs[2][1];r.children("td").eq(l++).text("반대"),r.children("td").eq(l++).html(`\n              <a href="javascript:void(0);" onclick="onClickShowOpposeReason('${e}');" class="red">\n                <i class="fas fa-comment-dots mRight5"></i>${stringShortDot(e,15)}\n              </a>`)}else i=2,r.addClass("timeout"),r.children("td").eq(l++).text("-"),r.children("td").eq(l++).text("-"),r.children("td").eq(l++).text("미이행");return $(".list_table").eq(0).children("tbody").append(r),i}f.children("tr").children("td").eq(1).children("span").eq(0).children("span").text(h[0]),f.children("tr").children("td").eq(1).children("span").eq(1).children("span").text(h[1]),f.children("tr").children("td").eq(1).children("span").eq(2).children("span").text(h[2])}}function v(e,t){for(let a=0;a<e.length;++a)if(e[a].is_seq==t)return e[a].contents;return"Error!!"}function b(e,t){for(let a=0;a<e.length;++a)if(e[a].file_idx==t)return e[a]}{var q=e.getItemData("ibc_ca_file");let le=(a=e.getItemData("ibc_ca_item")).dataObj.saved_data.data;for(const[se,ce]of Object.entries(le)){let _e=b(q.dataObj.saved_data.data,Number(se));var x=JSON.parse(ce);let oe={};var I=3;if(286==Number(se)){oe=changeMemberTemplate.clone(),oe.find(".data").eq(2).text(x[2]);var S=oe.find(".data").find("tbody").eq(0),O=oe.find(".data").find("tbody").eq(1),j=S.children("tr").eq(0),P=O.children("tr").eq(0);oe.find(".data").find("tbody").empty();var w=[],D=e.getParentItemData("general_director");w.push(D.dataObj.saved_data.data[0]);for(var A=D.dataObj.saved_data.data[0].user_seq,T=e.getParentItemData("general_expt"),k=0;k<Object.keys(T.dataObj.saved_data.data).length;k++)w.push(T.dataObj.saved_data.data[k]);$.each(w,(function(e,t){let a="";if(t.edu_course){let n=JSON.parse(t.edu_course);for(e in n)a+=`\n              <div class="flexMid">\n                <span class="w120 mRight5">${e}</span>\n                <div>${n[e]}</div>\n              </div>`}var n=j.clone(),d=t.info;A==t.user_seq?n.children("td").eq(0).find("input").prop("checked",!0):(n.children("td").eq(0).find("input").prop("checked",!1),n.children("td").eq(0).find("input").prop("disabled",!0)),1==t.animal_mng_flag?n.children("td").eq(1).find("input").prop("checked",!0):(n.children("td").eq(1).find("input").prop("checked",!1),n.children("td").eq(1).find("input").prop("disabled",!0)),n.children("td").eq(2).text(d.name),n.children("td").eq(3).text(d.dept_str),n.children("td").eq(4).append(a),S.append(n)}));var y=[],C=e.getItemData("general_director");y.push(C.dataObj.saved_data.data[0]);var N=C.dataObj.saved_data.data[0].user_seq,M=e.getItemData("general_expt");for(k=0;k<Object.keys(M.dataObj.saved_data.data).length;k++)y.push(M.dataObj.saved_data.data[k]);$.each(y,(function(e,t){let a="";if(t.edu_course){let n=JSON.parse(t.edu_course);for(e in n)a+=`\n              <div class="flexMid">\n                <span class="w120 mRight5">${e}</span>\n                <div>${n[e]}</div>\n              </div>`}var n=P.clone(),d=t.info;N==t.user_seq?n.children("td").eq(0).find("input").prop("checked",!0):(n.children("td").eq(0).find("input").prop("checked",!1),n.children("td").eq(0).find("input").prop("disabled",!0)),1==t.animal_mng_flag?n.children("td").eq(1).find("input").prop("checked",!0):(n.children("td").eq(1).find("input").prop("checked",!1),n.children("td").eq(1).find("input").prop("disabled",!0)),n.children("td").eq(2).text(d.name),n.children("td").eq(3).text(d.dept_str),n.children("td").eq(4).append(a),O.append(n)}))}else if(288==Number(se)){oe=changeEndDateTemplate.clone();var E=e.getParentItemData("application_info");let pe=getTimeStrFromDateType(new Date(getDttm(Number(E.getStringValue("approved_dttm"))).dt));var R=e.getParentItemData("general_end_date"),F=getTimeStrFromDateType(new Date(R.getStringValue("0"))),U=e.getItemData("general_end_date"),J=getTimeStrFromDateType(new Date(U.getStringValue("0")));oe.find(".data").eq(2).text(pe+"~"+F),oe.find(".data").eq(3).text(pe+"~"+J),oe.find(".data").eq(4).text(x[2]),I=5}else oe=changeInfoTemplate.clone(),oe.find("label").eq(0).text(v(a.dataObj.codes,Number(se))),oe.find(".data").eq(1).text(x[1]),oe.find(".data").eq(2).text(x[2]);null==_e?oe.find(".data").eq(I).text(""):(oe.find(".data").eq(I).text(_e.org_file_name),oe.find(".data").eq(I).attr("href",_e.src));var V=`newWindowPopup('./_popup_app-IBC_info_all.html#form_${x[0]}')`;oe.find("a").first().attr("onclick",V),oe.find("a").eq(0).empty();var B=`<i class="fas fa-link mRight5"></i>심의 신청서 : ${IPSAP.IBC_MAIN_TAGE_NAME[x[0]]}`;oe.find("a").eq(0).append(B),$("#change_application").append(oe)}}$(".agree_date").eq(0).text(getDate(g_AppInfo.appObj.submit_dttm)),$(".reviewer").eq(0).text(spaceAddStr(g_AppInfo.appObj.user_name)),(a=e.getItemData("final_judge_result")).makeHtmlRadioType(IPSAP.COL.ALL,0),$(".card").removeClass("hidden")}function onClickShowAgreeReason(e){$(".agree_reason").text(e),$("#modal_agree_comment").modal("show")}function onClickShowOpposeReason(e){$(".oppose_reason").text(e),$("#modal_disagree_comment").modal("show")}function onClickFinalFinishSubmit(){$("#modal_confirm_review").modal("hide"),g_AppItemParser.targetSavedItemNames=["final_judge_result"];var e=IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_FINAL_REJECT;switch(Number($('input:radio[name="final_judge_result_0"]:checked').val())){case 1:e=IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_FINAL_A;break;case 2:e=IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_FINAL_AC;break;case 3:e=IPSAP.APP_SUBMIT_TYPE_PARAM.JUDGE_FINAL_REQUIRE_RETRY}appItemSubmit(onCompleteFinalFinishSubmit,e)}function onCompleteFinalFinishSubmit(e,t,a){e?window.location.href="../reviewConfirm_list.html":appSubmitHandleError("심의 완료를 실패했습니다.",t)}$((function(){loadApplicationParams();$(".page-content");$('[data-target="#modal_confirm_review"]').on("click",(function(){if(""==$('input:radio[name="final_judge_result_0"]:checked').siblings().closest("input").val())return alert("최종 심의 결과를 입력해 주시기 바랍니다."),!1})),changeInfoTemplate=$("#change_application").children("ul").eq(0).clone(),changeMemberTemplate=$("#change_application").children("ul").eq(1).clone(),changeEndDateTemplate=$("#change_application").children("ul").eq(2).clone(),$("#change_application").empty(),$("#change_application").removeClass("hidden"),g_AppItemParser=new ItemParser(g_AppInfo.childAppSeq),g_AppItemParser.load({"filter.query_items":"ibc_change_application,expert_member,expert_review_result,expert_review_dttm,expert_review_total_review,normal_review_result,committee_in_member,committee_ex_member,normal_review_dttm,final_judge_result","filter.parent_items":"general_title,general_end_date,application_info,general_director,general_expt,ibc_general_experiment"},dataMappingFunc)}));