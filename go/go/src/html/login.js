var g_data;$(function(){function typeAndAuthCheckAfterRedirect(user_type,user_auth,request_path_arr){var page_user_type,request_path=request_path_arr.substring(request_path_arr.indexOf("?")+1,request_path_arr.length),request_path_arr=request_path.split("/");if("officer"==request_path_arr[2]?page_user_type=1:"chairman"==request_path_arr[2]?page_user_type=2:"researcher"==request_path_arr[2]?page_user_type=3:"committee"==request_path_arr[2]&&(page_user_type=4),user_type[page_user_type])location.replace(request_path);else{var service_status=Number(JSON.parse(COMM.getCookie("institution_info")).service_status);switch(parseInt(user_auth)){case IPSAP.USER_AUTH.AUTH_NOMARL:case IPSAP.USER_AUTH.AUTH_INSTITUTION:user_type[IPSAP.USER_TYPE.ADMIN_OFFICER]||user_type[IPSAP.USER_TYPE.OFFICER]?location.replace("/html/officer/dashboard.html"):user_type[IPSAP.USER_TYPE.CHAIRMAN]?location.replace("/html/chairman/dashboard.html"):user_type[IPSAP.USER_TYPE.COMMITTEE]?1==service_status?location.replace("/html/committee/review_list.html"):location.replace("/html/committee/info_me.html"):user_type[IPSAP.USER_TYPE.RESEARCHER]?location.replace("/html/researcher/dashboard.html"):alert("권한이 없습니다.");break;case IPSAP.USER_AUTH.AUTH_PLATFORM:case IPSAP.USER_AUTH.AUTH_SYSTEM:location.replace("/html/admin/dashboard.html")}}}$('[data-target="#modal_login"]').on({click:function(e){var user_info;!COMM.getCookie(CONST.COOKIE.IPSAP_TOKEN)||(user_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)))&&typeAndAuthCheckAfterRedirect(user_info.user_type,user_info.user_auth,cb_url)}}),(COMM.getCookie(CONST.COOKIE.IPSAP_TOKEN)?$(".btn_top_logout_set"):$(".btn_top_login_set")).css("display","inline-block"),$("[name=pw], [name=email]",".login_body").off().on("keydown",function(e){13==e.keyCode&&$("#btn_login").trigger("click")}),$("#btn_login").click(function(e){e.preventDefault();var param=$(this).parent().serialize();return(param=COMM.paramStr2Object(param)).tmp_key=COMM.getLoginKey($("[name=email]").val()),param.pw=COMM.getEncrypt(param.tmp_key,param.pw),API.load({url:CONST.API.AUTH.LOGIN,type:CONST.API_TYPE.POST,data:param,success:function(modal_type){if(1==modal_type.length){var user_info=modal_type[0].user_info,institution_info=modal_type[0].ins_info,cb_url=window.location.search;if(institution_info.institution_status<9)alert("기관 등록을 위한 심사가 진행중입니다.");else{let inspect_info=new Object;var inspect_info_time=(new Date).getTime();1==user_info.inspector&&(inspect_info.inspect_flag=!0,inspect_info.inspect_info_time=inspect_info_time,COMM.setCookie("inspect_info",JSON.stringify(inspect_info))),COMM.setCookie(CONST.COOKIE.IPSAP_TMP_KEY,COMM.getDecrypt(param.tmp_key,modal_type[0].tmp_key)),COMM.setCookie("user_info",JSON.stringify(user_info)),COMM.setCookie("institution_info",JSON.stringify(institution_info)),COMM.setCookie("logo_file_src",institution_info.logo_file_src),COMM.setCookie(CONST.COOKIE.IPSAP_TOKEN,modal_type[0].token),"1"!=user_info.user_status?typeAndAuthCheckAfterRedirect(user_info.user_type,user_info.user_auth,cb_url):location.replace("./html/register/register-agreement.html")}}else{idx=0,$("#modal_all_joining").find(".list-group").empty(),$.each(modal_type,function(index,item){var html='<li class="list-group-item flexMid flexBetween noBackground">',list_inst_name=item.ins_info.name_ko,list_inst_code=item.ins_info.institution_code;"3"==item.user_info.user_status?html+=`<a href="#" data-idx="${idx++}"><i class="fas fa-building mRight10"></i>${list_inst_name} (${list_inst_code})</a>
                <div class="btn btn-danger btn_xxs inst_register">등록하기</div></li>`:html+=`<a href="#" data-idx="${idx++}"><i class="fas fa-building mRight10"></i>${list_inst_name} (${list_inst_code})</a>
                <div class="btn btn-primary btn_xxs inst_go">바로가기</div></li>`,$("#modal_all_joining").find(".list-group").append(html)}),$(".modal").modal("hide");modal_type=$("body").hasClass("full_modal")?"full":"pup";$("#modal_all_joining").modal("show"),$("#modal_all_joining [data-toggle=modal]").data("modal-type",modal_type),$("#modal_login").find(".login_body").find(".form-control").val("")}},error:function(err){return alert("로그인할 수 없습니다.\n입력한 로그인 정보가 바르지 않습니다."),!1},complete:function(data){$(".inst_go").on("click",function(){var data_idx=$(this).siblings().data("idx"),user_info=data.responseJSON[data_idx].user_info,institution_info=data.responseJSON[data_idx].ins_info,cb_url=window.location.search;if(institution_info.institution_status<9)alert("기관 등록을 위한 심사가 진행중입니다.");else{let inspect_info=new Object;var inspect_info_time=(new Date).getTime();1==user_info.inspector&&(inspect_info.inspect_flag=!0,inspect_info.inspect_info_time=inspect_info_time,COMM.setCookie("inspect_info",JSON.stringify(inspect_info))),COMM.setCookie(CONST.COOKIE.IPSAP_TMP_KEY,COMM.getDecrypt(param.tmp_key,data.responseJSON[data_idx].tmp_key)),COMM.setCookie("user_info",JSON.stringify(user_info)),COMM.setCookie("institution_info",JSON.stringify(institution_info)),COMM.setCookie("logo_file_src",institution_info.logo_file_src),COMM.setCookie(CONST.COOKIE.IPSAP_TOKEN,data.responseJSON[data_idx].token),typeAndAuthCheckAfterRedirect(user_info.user_type,user_info.user_auth,cb_url)}}),$(".inst_register").on("click",function(){var data_idx=$(this).siblings().data("idx"),user_info=data.responseJSON[data_idx].user_info,institution_info=data.responseJSON[data_idx].ins_info;institution_info.institution_status<9?alert("기관 등록을 위한 심사가 진행중입니다."):(COMM.setCookie(CONST.COOKIE.IPSAP_TMP_KEY,COMM.getDecrypt(param.tmp_key,data.responseJSON[data_idx].tmp_key)),COMM.setCookie("user_info",JSON.stringify(user_info)),COMM.setCookie("institution_info",JSON.stringify(institution_info)),COMM.setCookie("logo_file_src",institution_info.logo_file_src),COMM.setCookie(CONST.COOKIE.IPSAP_TOKEN,data.responseJSON[data_idx].token),location.replace("./html/register/register-agreement.html"))})}}),!1}),$("body").hasClass("full_modal")&&$("body").hasClass("login")&&($("#modal_login").modal("show"),$(document).on({keydown:function(e){if(27==e.keyCode)return $("#modal_login").modal("show"),!1}}))});