function loginEvent(){var param=new Object;param.tmp_key=COMM.getLoginKey($("[name=email]").val()),$(".inst_go_top").on("click",function(){API.load({url:CONST.API.INSTITUTION.MY_INST,type:CONST.API_TYPE.POST,data:param,success:function(modal_type){var user_info;1==modal_type.length?(user_info=COMM.getCookie("user_info"),user_info=JSON.parse(user_info),typeAndAuthCheckAfterRedirect(user_info.user_type,user_info.user_auth)):(idx=0,$("#modal_all_joining").find(".list-group").empty(),$.each(modal_type,function(index,item){var html='<li class="list-group-item flexMid flexBetween noBackground">',list_inst_name=item.ins_info.name_ko,list_inst_code=item.ins_info.institution_code;3==item.user_info.user_status?html+=`<a href="#" data-idx="${idx++}"><i class="fas fa-building mRight10"></i>${list_inst_name} (${list_inst_code})</a>
              <div class="btn btn-danger btn_xxs inst_register">등록하기</div></li>`:html+=`<a href="#" data-idx="${idx++}"><i class="fas fa-building mRight10"></i>${list_inst_name} (${list_inst_code})</a>
              <div class="btn btn-primary btn_xxs inst_go">바로가기</div></li>`,$("#modal_all_joining").find(".list-group").append(html)}),$(".modal").modal("hide"),modal_type=$("body").hasClass("full_modal")?"full":"pop",$("#modal_all_joining").modal("show"),$("#modal_all_joining [data-toggle=modal]").data("modal-type",modal_type))},error:function(err){return alert("로그인할 수 없습니다.\n입력한 로그인 정보가 바르지 않습니다."),!1},complete:function(data){$(".inst_go").on("click",function(){var data_idx=$(this).siblings().data("idx"),user_info=data.responseJSON[data_idx].user_info,institution_info=data.responseJSON[data_idx].ins_info,cb_url=window.location.search;data.responseJSON.institution_status<9?alert("기관에 대한 심사가 진행중입니다."):(COMM.setCookie(CONST.COOKIE.IPSAP_TOKEN,data.responseJSON[data_idx].token),COMM.setCookie("user_info",JSON.stringify(user_info)),COMM.setCookie("institution_info",JSON.stringify(institution_info)),COMM.setCookie("logo_file_src",institution_info.logo_file_src),typeAndAuthCheckAfterRedirect(user_info.user_type,user_info.user_auth,cb_url))}),$(".inst_register").on("click",function(){var data_idx=$(this).siblings().data("idx");data.responseJSON[data_idx].user_info,data.responseJSON[data_idx].ins_info;data.responseJSON.institution_status<9?alert("기관에 대한 심사가 진행중입니다."):(COMM.setCookie(CONST.COOKIE.IPSAP_TOKEN,data.responseJSON[data_idx].token),location.replace("./html/register/register-agreement.html"))})}})})}function initGnb(){let pageUrl=window.location.href.split(/[?#]/)[0].split("-")[0].replace(".html",""),menu_pattern=pageUrl.split("/").pop().split("_")[0];$(`[data-menu="${menu_pattern}"]`).addClass("selected")}function setGnbEvent(){$(".gnb_bg, .gnb_body, .gnb_sub_wrapper").on({mouseenter:function(e){$(".gnb_body, .gnb_sub_wrapper, .gnb_bg").addClass("active")},mouseleave:function(e){$(".gnb_body, .gnb_sub_wrapper, .gnb_bg").removeClass("active")}}),$("#menu_10, #menu_20, #menu_30, #menu_40, #menu_50").on({mouseenter:function(e){let subMenu_id=$(this).attr("id"),menu_id=subMenu_id.substr(0,subMenu_id.length-1);$("#"+menu_id).addClass("active")},mouseleave:function(e){$("[id^=menu_]").removeClass("active")}})}function initActiveMainMenu(){var pageUrl=window.location.href.split(/[?#]/)[0].split("-")[0].replace(".html","");$(".menu_bg a").each(function(idx,ele){ele.href.split("-")[0].replace("#","").replace(".html","")==pageUrl&&$(this).addClass("active")}),setLoginModal()}function setLoginModal(){$('[data-target="#modal_login"]').on({click:function(e){var login_comment=void 0!==$(this).data("modal-type")&&"full"==$(this).data("modal-type")?"IPSAP의 프로토콜 리뷰 서비스에 로그인합니다.<br>등록된 아이디(Email)를 이용하여 로그인해 주세요.":"선택한 서비스는 로그인이 필요한 서비스입니다.<br>IPSAP의 프로토콜 리뷰 서비스에 로그인합니다.";$("#modal_login .login_header .comment").html(login_comment)}})}function setMainTabAnnounce(){var announce_body=$("#announce").find("tbody");announce_body.empty();API.load({url:CONST.API.BOARD.LIST,type:CONST.API_TYPE.GET,data:{"filter.board_type":1,"filter.institution_seq":0},success:function(data){$.each(data,function(key,item){announce_body.append(`
          <tr data-url="/html/ipsap/board_01-info.html" data-board="${item.board_seq}">
            <td>${item.title}</td>
            <td>${item.reg_dttm}</td>
          </tr>`)})},complete:function(){setTriggerTrDataUrlOnClick()}})}function setMainTabReference(){var reference_body=$("#reference").find("tbody");reference_body.empty();API.load({url:CONST.API.BOARD.LIST,type:CONST.API_TYPE.GET,data:{"filter.board_type":2,"filter.institution_seq":0},success:function(data){$.each(data,function(key,item){reference_body.append(`
          <tr data-url="/html/ipsap/board_02-info.html" data-board="${item.board_seq}">
            <td>${item.title}</td>
            <td>${item.reg_dttm}</td>
          </tr>`)})},complete:function(){setTriggerTrDataUrlOnClick()}})}function setMainTabFAQ(){var faq_body=$("#faq").find("tbody");faq_body.empty();API.load({url:CONST.API.BOARD.LIST,type:CONST.API_TYPE.GET,data:{"filter.board_type":3,"filter.institution_seq":0},success:function(data){$.each(data,function(key,item){faq_body.append(`
          <tr data-url="/html/ipsap/board_03-list.html" data-board="${item.board_seq}">
            <td>${item.title}</td>
            <td>${item.reg_dttm}</td>
          </tr>`)})},complete:function(){setTriggerTrDataUrlOnClick()}})}function setInformationPopup(){$("#modal_information").on("hide.bs.modal",function(e){$("#daycheck").is(":checked")&&COMM.setCookie("popup-expire",!0,1440),e.stopImmediatePropagation()}),COMM.getCookie("popup-expire")?$("#modal_information").modal("hide"):$("#modal_information").modal("show")}function alertLogin(){alert("로그인이 필요한 서비스 입니다.")}$(function(){var user_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO));$("body").hasClass("index"),$("#main_gnb_menu").load("/html/common/inc/_ipsap_gnb.html",function(){(COMM.getCookie(CONST.COOKIE.IPSAP_TOKEN)?$(".btn_top_logout_set"):$(".btn_top_login_set")).css("display","inline-block"),loginEvent(),initGnb(),setGnbEvent(),initActiveMainMenu()}),$("#main_login_menu").load("/html/common/inc/_ipsap_login.html",function(){COMM.getCookie(CONST.COOKIE.IPSAP_TOKEN)?"1"==user_info.user_status?($(".btn_top_register_set").css("display","inline-block"),$("#ipsapLogout").css("display","inline-block")):$(".btn_top_logout_set").css("display","inline-block"):$(".btn_top_login_set").css("display","inline-block"),loginEvent(),initGnb(),setGnbEvent(),initActiveMainMenu(),ipsapLogOut()}),$("footer").load("/html/common/inc/_ipsap_footer.html",function(){user_info&&("9"==user_info.user_auth||"10"==user_info.user_auth)?$(".admin_link").css("display","block"):$(".admin_link").css("display","none")}),$('[data-target="#modal_login"]').on({click:function(e){var user_info;!COMM.getCookie(CONST.COOKIE.IPSAP_TOKEN)||(user_info=JSON.parse(COMM.getCookie(CONST.COOKIE.IPSAP_USER_INFO)))&&typeAndAuthCheckAfterRedirect(user_info.user_type,user_info.user_auth,cb_url)}}),$("#btn_find_id").on({click:function(e){var find_id_form=$("#find_id").find("form"),param=find_id_form.serialize(),param=COMM.paramStr2Object(param);API.load({url:CONST.API.AUTH.FIND_ID,type:CONST.API_TYPE.POST,data:param,success:function(data){$(".modal").modal("hide");var modal_type=$("body").hasClass("full_modal")?"full":"pop";$("#modal_find_id_result").find(".login_body").find("span").text(data),$("#modal_find_id_result").modal("show"),$("#modal_find_id_result [data-toggle=modal]").data("modal-type",modal_type)},error:function(){return alert("정보를 다시 입력해 주세요.\n(입력한 정보와 일치하는 사용자를 찾을 수 없습니다.)"),!1},complete:function(){find_id_form.find("input").val("")}})}}),$("#btn_find_pw").on({click:function(e){var find_pw_form=$("#find_pw").find("form"),user_id=find_pw_form.find('input[name="email"]').val(),param=find_pw_form.serialize(),param=COMM.paramStr2Object(param);API.load({url:CONST.API.AUTH.FIND_PWD,type:CONST.API_TYPE.POST,data:param,success:function(data){$(".modal").modal("hide");var modal_type=$("body").hasClass("full_modal")?"full":"pop";$("#modal_find_pw_result").find(".login_body").find("span").text(user_id),$("#modal_find_pw_result").modal("show"),$("#modal_find_pw_result [data-toggle=modal]").data("modal-type",modal_type)},error:function(){return alert("정보를 다시 입력해 주세요.\n(입력한 정보와 일치하는 사용자를 찾을 수 없습니다.)"),!1},complete:function(){find_pw_form.find("input").val("")}})}}),$("#modal_find_id_result").on("hidden.bs.modal",function(){$("#modal_find_id_result").find(".login_body").find("span").text("")}),$("#modal_find_pw_result").on("hidden",function(){$("#modal_find_pw_result").find(".login_body").find("span").text("")}),setMainTabAnnounce(),setMainTabReference(),setMainTabFAQ()});